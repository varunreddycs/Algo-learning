<!DOCTYPE html>
<!-- saved from url=(0132)https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e -->
<html xmlns:cc="http://creativecommons.org/ns#" class="gr__medium_com"><script type="text/javascript" charset="utf-8" id="zm-extension" src="chrome-extension://fdcgdnkidjaadafnichfpabhfomcebme/scripts/webrtc-patch.js" async=""></script><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# medium-com: http://ogp.me/ns/fb/medium-com#"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=contain"><title>Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…</title><link rel="canonical" href="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e"><meta name="title" content="Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…"><meta name="referrer" content="always"><meta name="description" content="Spark and pyspark have wonderful support for reliable distribution and parallelization of programs as well as support for many basic algebraic operations and machine learning algorithms. In this post…"><meta name="theme-color" content="#000000"><meta property="og:title" content="Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…"><meta property="twitter:title" content="Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…"><meta property="og:url" content="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e"><meta property="fb:app_id" content="542599432471018"><meta property="og:description" content="Spark and pyspark have wonderful support for reliable distribution and parallelization of programs as well as support for many basic…"><meta name="twitter:description" content="Spark and pyspark have wonderful support for reliable distribution and parallelization of programs as well as support for many basic…"><link rel="publisher" href="https://plus.google.com/103654360130207659246"><link rel="author" href="https://medium.com/@rantav"><meta property="author" content="Ran Tavory"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta property="article:publisher" content="https://www.facebook.com/medium"><meta property="article:author" content="Ran Tavory"><meta name="robots" content="index, follow"><meta property="article:published_time" content="2016-08-02T18:42:34.903Z"><meta name="twitter:creator" content="@rantav"><meta name="twitter:site" content="@Medium"><meta property="og:site_name" content="Medium"><meta name="twitter:label1" value="Reading time"><meta name="twitter:data1" value="14 min read"><meta name="twitter:app:name:iphone" content="Medium"><meta name="twitter:app:id:iphone" content="828256236"><meta name="twitter:app:url:iphone" content="medium://p/1be4b1b2871e"><meta property="al:ios:app_name" content="Medium"><meta property="al:ios:app_store_id" content="828256236"><meta property="al:android:package" content="com.medium.reader"><meta property="al:android:app_name" content="Medium"><meta property="al:ios:url" content="medium://p/1be4b1b2871e"><meta property="al:android:url" content="medium://p/1be4b1b2871e"><meta property="al:web:url" content="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e"><link rel="search" type="application/opensearchdescription+xml" title="Medium" href="https://medium.com/osd.xml"><link rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/1be4b1b2871e"><script type="application/ld+json">{"@context":"http://schema.org","@type":"NewsArticle","image":{"@type":"ImageObject","width":545,"height":106,"url":"https://cdn-images-1.medium.com/max/545/1*OMF3fSqH8t4xBJ9-6oZDZw.png"},"url":"https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e","dateCreated":"2016-08-02T18:42:34.903Z","datePublished":"2016-08-02T18:42:34.903Z","dateModified":"2018-06-14T13:10:09.120Z","headline":"Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…","name":"Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…","thumbnailUrl":"https://cdn-images-1.medium.com/max/545/1*OMF3fSqH8t4xBJ9-6oZDZw.png","keywords":["Tag:Data Science","Tag:Machine Learning","LockedPostSource:0","Elevated:false","LayerCake:0"],"author":{"@type":"Person","name":"Ran Tavory","url":"https://medium.com/@rantav"},"creator":["Ran Tavory"],"publisher":{"@type":"Organization","name":"Medium","url":"https://medium.com/","logo":{"@type":"ImageObject","width":308,"height":60,"url":"https://cdn-images-1.medium.com/max/308/1*OMF3fSqH8t4xBJ9-6oZDZw.png"}},"mainEntityOfPage":"https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e"}</script><meta name="parsely-link" content="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e"><link rel="stylesheet" type="text/css" class="js-glyph-" id="glyph-8" href="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/m2.css"><link rel="stylesheet" href="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/main-branding-base.Jb-klQS5V5uWEz2HCHwK3w.css"><script>if (window.top !== window.self) window.top.location = window.self.location.href;var OB_startTime = new Date().getTime(); var OB_loadErrors = []; function _onerror(e) { OB_loadErrors.push(e) }; if (document.addEventListener) document.addEventListener("error", _onerror, true); else if (document.attachEvent) document.attachEvent("onerror", _onerror); function _asyncScript(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("script"); s.type = "text/javascript"; s.async = true; s.src = u; f.parentNode.insertBefore(s, f);}function _asyncStyles(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("link"); s.rel = "stylesheet"; s.href = u; f.parentNode.insertBefore(s, f); return s}(new Image()).src = "/_/stat?event=pixel.load&origin=" + encodeURIComponent(location.origin);</script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; ga("create", "UA-24232453-2", "auto", {"allowLinker": true, "legacyCookieDomain": window.location.hostname}); ga("send", "pageview");</script><script async="" src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/analytics.js.download"></script><!--[if lt IE 9]><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js"></script><![endif]--><link rel="icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico" class="js-favicon"><link rel="apple-touch-icon" sizes="152x152" href="https://cdn-images-1.medium.com/fit/c/152/152/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="apple-touch-icon" sizes="120x120" href="https://cdn-images-1.medium.com/fit/c/120/120/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn-images-1.medium.com/fit/c/76/76/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="apple-touch-icon" sizes="60x60" href="https://cdn-images-1.medium.com/fit/c/60/60/1*8I-HPL0bfoIzGied-dzOvA.png"><link rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg" color="#171717"></head><body itemscope="" class="postShowScreen browser-chrome os-windows is-withMagicUnderlinesv-glyph v-glyph--m2 is-js is-withMagicUnderlines" data-gr-c-s-loaded="true" data-action-scope="_actionscope_0"><script>document.body.className = document.body.className.replace(/(^|\s)is-noJs(\s|$)/, "$1is-js$2")</script><div class="site-main surface-container" id="container"><div class="butterBar butterBar--error" data-action-scope="_actionscope_1"></div><div class="surface" id="_obv.shell._surface_1535517166610" style="display: block; visibility: visible;"><div class="screenContent surface-content is-supplementalPostContentLoaded" data-used="true" data-action-scope="_actionscope_2"><canvas class="canvas-renderer" width="1349" height="577"></canvas><div class="container u-maxWidth740 u-xs-margin0 notesPositionContainer js-notesPositionContainer"><div class="notesMarkers" data-action-scope="_actionscope_4"></div></div><div class="metabar u-clearfix js-metabar u-fixed u-backgroundTransparentWhiteDarkest u-xs-sizeFullViewportWidth"><div class="js-metabarMiddle metabar-inner u-marginAuto u-maxWidth1000 u-flexCenter u-justifyContentSpaceBetween u-height65 u-xs-height56 u-paddingLeft20 u-paddingRight20"><div class="metabar-block u-flex1 u-flexCenter"><div class="js-metabarLogoLeft u-xs-show"><a href="https://medium.com/" data-log-event="home" class="siteNav-logo"><span class="svgIcon svgIcon--logoWordmark svgIcon--138x27px is-flushLeft u-xs-hide u-textColorDarker"><svg class="svgIcon-use" width="138" height="27" viewBox="0 0 138 27"><path d="M130 27V16.96c0-3.26-.154-5.472-2.437-5.472-1.16 0-2.138.57-2.863 1.512.217.906.3 1.968.3 3.127 0 2.247.036 5.11 0 7.973 0 .472-.046.58.244.87L127 27h-8V16.96c0-3.297-.461-5.472-2.708-5.472-1.16 0-1.64.653-2.292 1.595V24.1c0 .472-.026.58.3.87L116 27h-8V11.56c0-.47-.07-.579-.36-.905L106 9h8v3.612c.906-2.537 2.437-4.112 5.372-4.112 2.682 0 4.494 1.466 5.255 4.257.834-2.392 3.008-4.257 6.053-4.257 3.588 0 5.32 2.626 5.32 7.627 0 2.392.036 5.11 0 7.973 0 .472.004.652.25.87L138 27h-8zm-27-3.045c0 .472-.149.617.178.906L105 27h-8v-4c-.906 2.465-2.956 4-5.637 4C87.775 27 86 24.39 86 19.461c0-2.391-.036-5 0-7.936 0-.471-.11-.58-.4-.87L84 9h8v9.628c0 3.225.269 5.4 2.298 5.4 1.16 0 2.086-.725 2.702-1.63V11.56c0-.471-.129-.58-.419-.906L95 9h8v14.955zM78.002.25A3.248 3.248 0 0 1 81.25 3.5 3.25 3.25 0 1 1 78.002.25zM75 27V11.56c0-.47.168-.579-.122-.905L73 9h8v15.1c0 .472-.01.678.24.9L83 27h-8zM64 11.706c-.507-.652-1.418-1.123-2.396-1.123-1.957 0-3.842 1.775-3.842 7.03 0 4.93 1.631 6.669 3.66 6.669.907 0 1.853-.436 2.578-1.378V11.706zm6 12.286c0 .47-.026.58.3.87L72 27h-8v-3.697C62.913 25.804 60.951 27 58.632 27 54.5 27 51.5 23.738 51.5 17.795c0-5.582 3.254-9.314 7.784-9.314 2.356 0 3.919 1.123 4.716 2.899V3.878c0-.471-.077-.617-.403-.906L62 1.305 70 .29v23.702zM43.9 16c.037-.471.037-.67.037-.815 0-4.747-.937-5.435-2.437-5.435-1.5 0-2.854.995-2.927 6.25h5.328zm-5.327 1c0 4.711 2.392 6.63 5.183 6.63 2.174 0 4.313-.943 5.509-3.335h.072c-.942 4.566-3.77 6.705-8.01 6.705-4.566 0-8.879-2.755-8.879-9.133 0-6.705 4.277-9.386 9.097-9.386 3.842 0 7.937 1.811 7.937 7.646 0 .109 0 .438-.036.873H38.573zM31.5 27h-12l2.39-2.646c.084-.084.11-.399.11-.87V7l-7.866 20L5.581 8.372C5.364 7.9 5.181 7.285 5 6.777V20.62c0 .58-.035.653.364 1.196L9 27H0l3.64-5.183c.399-.543.36-.616.36-1.196V6.27c0-.617.095-.69-.195-1.051L1 1h8.495l7.355 16.3L23.24 1h8.26l-2.2 2.75c-.326.326-.3.599-.3 1.106v18.629c0 .47.005.75.138.87L31.5 27z"></path></svg></span><span class="svgIcon svgIcon--logoWordmark svgIcon--122x45px is-flushLeft u-xs-show u-textColorDarker"><svg class="svgIcon-use" width="122" height="45" viewBox="0 0 122 45"><path d="M61.6 31.806c0 .412 0 .505.28.758l1.574 1.537v.065h-6.979v-2.95a4.852 4.852 0 0 1-4.627 3.203c-3.588 0-6.192-2.81-6.192-7.981 0-4.843 2.81-8.075 6.754-8.075a4.122 4.122 0 0 1 4.056 2.51v-6.51a.806.806 0 0 0-.319-.787l-1.499-1.443v-.065l6.951-.815v20.553zm-5.125-.937v-9.714a2.614 2.614 0 0 0-2.08-.975c-1.695 0-3.334 1.537-3.334 6.099 0 4.271 1.414 5.78 3.175 5.78a2.81 2.81 0 0 0 2.24-1.19zm9.752 3.297V21.051a.88.88 0 0 0-.281-.786L64.4 18.672v-.065h6.98v13.302c0 .412 0 .505.28.758l1.536 1.443v.066l-6.97-.01zm-.253-20.356a2.81 2.81 0 1 1 5.62 0 2.81 2.81 0 0 1-5.62 0zm24.234 17.967c0 .413 0 .534.281.787l1.574 1.537v.065h-7.017v-3.363a5.077 5.077 0 0 1-4.805 3.616c-3.11 0-4.778-2.267-4.778-6.557 0-2.07 0-4.337.066-6.885a.796.796 0 0 0-.281-.76l-1.546-1.545v-.065h6.923v8.552c0 2.81.412 4.684 2.173 4.684a2.81 2.81 0 0 0 2.267-1.415v-9.367a.88.88 0 0 0-.28-.787l-1.556-1.602v-.065h6.979v13.17zm23.756 2.39c0-.507.094-6.952.094-8.432 0-2.81-.44-4.75-2.417-4.75a3.138 3.138 0 0 0-2.482 1.35c.198.876.292 1.772.28 2.67 0 1.948-.065 4.43-.093 6.913a.796.796 0 0 0 .281.759l1.574 1.442v.066h-7.045c0-.468.094-6.95.094-8.431 0-2.857-.44-4.75-2.389-4.75a2.81 2.81 0 0 0-2.323 1.387v9.555c0 .412 0 .506.281.759l1.537 1.442v.066h-6.97V21.098a.88.88 0 0 0-.281-.787l-1.546-1.639v-.065h6.98v3.334a5.002 5.002 0 0 1 5.002-3.587c2.323 0 3.896 1.292 4.562 3.747a5.433 5.433 0 0 1 5.245-3.747c3.11 0 4.872 2.295 4.872 6.632 0 2.07-.066 4.43-.094 6.913a.75.75 0 0 0 .318.759l1.537 1.443v.065h-7.017zm-87.671-2.043l2.07 1.977v.065H17.862v-.065l2.107-1.977a.796.796 0 0 0 .281-.759V18.728c0-.534 0-1.255.094-1.873l-7.082 17.564h-.084L5.843 18.26c-.16-.402-.206-.43-.31-.702v10.595c-.087.71.034 1.429.348 2.07l2.95 3.879v.065H1v-.065l2.95-3.888a3.69 3.69 0 0 0 .347-2.06v-11.71a2.267 2.267 0 0 0-.487-1.602l-2.089-2.708v-.065h7.494l6.277 13.686 5.527-13.686h7.335v.065l-2.061 2.296a.806.806 0 0 0-.319.786v16.15a.75.75 0 0 0 .319.759zm8.215-6.332v.065c0 4.01 2.07 5.62 4.497 5.62a5.105 5.105 0 0 0 4.777-2.894h.066c-.844 3.963-3.298 5.836-6.97 5.836-3.962 0-7.7-2.389-7.7-7.925 0-5.817 3.747-8.14 7.887-8.14 3.335 0 6.886 1.573 6.886 6.632v.806h-9.443zm0-.806h4.618v-.815c0-4.122-.852-5.218-2.136-5.218-1.555 0-2.5 1.64-2.5 6.033h.018z"></path></svg></span><span class="u-textScreenReader">Homepage</span></a></div><a class="link link--darken u-accentColor--textDarken u-baseColor--link u-xs-hide js-upgradeMembershipAction" href="https://medium.com/upgrade?source=upgrade_membership---nav_full" data-scroll="native">Become a member</a></div><div class="metabar-block u-flex0"><div class="buttonSet buttonSet--wide"><a class="button button--primary button--chromeless u-accentColor--buttonNormal is-inSiteNavBar u-xs-hide js-signInButton" href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2F%40rantav%2Flarge-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e&amp;source=--------------------------nav_reg&amp;operation=login" data-action="sign-in-prompt" data-redirect="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e" data-action-source="--------------------------nav_reg">Sign in</a><a class="button button--primary button--withChrome u-accentColor--buttonNormal is-inSiteNavBar js-signUpButton" href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2F%40rantav%2Flarge-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e&amp;source=--------------------------nav_reg&amp;operation=register" data-action="sign-up-prompt" data-redirect="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e" data-action-source="--------------------------nav_reg">Get started</a></div></div><div class="u-absolute u-sizeFullWidth u-top0 u-right0 u-bottom0 u-flexCenter u-justifyContentCenter u-textAlignCenter u-xs-hide js-metabarLogoCentered"><a href="https://medium.com/" data-log-event="home" class="siteNav-logo"><span class="svgIcon svgIcon--logoWordmark svgIcon--138x27px is-flushLeft u-xs-hide u-textColorDarker"><svg class="svgIcon-use" width="138" height="27" viewBox="0 0 138 27"><path d="M130 27V16.96c0-3.26-.154-5.472-2.437-5.472-1.16 0-2.138.57-2.863 1.512.217.906.3 1.968.3 3.127 0 2.247.036 5.11 0 7.973 0 .472-.046.58.244.87L127 27h-8V16.96c0-3.297-.461-5.472-2.708-5.472-1.16 0-1.64.653-2.292 1.595V24.1c0 .472-.026.58.3.87L116 27h-8V11.56c0-.47-.07-.579-.36-.905L106 9h8v3.612c.906-2.537 2.437-4.112 5.372-4.112 2.682 0 4.494 1.466 5.255 4.257.834-2.392 3.008-4.257 6.053-4.257 3.588 0 5.32 2.626 5.32 7.627 0 2.392.036 5.11 0 7.973 0 .472.004.652.25.87L138 27h-8zm-27-3.045c0 .472-.149.617.178.906L105 27h-8v-4c-.906 2.465-2.956 4-5.637 4C87.775 27 86 24.39 86 19.461c0-2.391-.036-5 0-7.936 0-.471-.11-.58-.4-.87L84 9h8v9.628c0 3.225.269 5.4 2.298 5.4 1.16 0 2.086-.725 2.702-1.63V11.56c0-.471-.129-.58-.419-.906L95 9h8v14.955zM78.002.25A3.248 3.248 0 0 1 81.25 3.5 3.25 3.25 0 1 1 78.002.25zM75 27V11.56c0-.47.168-.579-.122-.905L73 9h8v15.1c0 .472-.01.678.24.9L83 27h-8zM64 11.706c-.507-.652-1.418-1.123-2.396-1.123-1.957 0-3.842 1.775-3.842 7.03 0 4.93 1.631 6.669 3.66 6.669.907 0 1.853-.436 2.578-1.378V11.706zm6 12.286c0 .47-.026.58.3.87L72 27h-8v-3.697C62.913 25.804 60.951 27 58.632 27 54.5 27 51.5 23.738 51.5 17.795c0-5.582 3.254-9.314 7.784-9.314 2.356 0 3.919 1.123 4.716 2.899V3.878c0-.471-.077-.617-.403-.906L62 1.305 70 .29v23.702zM43.9 16c.037-.471.037-.67.037-.815 0-4.747-.937-5.435-2.437-5.435-1.5 0-2.854.995-2.927 6.25h5.328zm-5.327 1c0 4.711 2.392 6.63 5.183 6.63 2.174 0 4.313-.943 5.509-3.335h.072c-.942 4.566-3.77 6.705-8.01 6.705-4.566 0-8.879-2.755-8.879-9.133 0-6.705 4.277-9.386 9.097-9.386 3.842 0 7.937 1.811 7.937 7.646 0 .109 0 .438-.036.873H38.573zM31.5 27h-12l2.39-2.646c.084-.084.11-.399.11-.87V7l-7.866 20L5.581 8.372C5.364 7.9 5.181 7.285 5 6.777V20.62c0 .58-.035.653.364 1.196L9 27H0l3.64-5.183c.399-.543.36-.616.36-1.196V6.27c0-.617.095-.69-.195-1.051L1 1h8.495l7.355 16.3L23.24 1h8.26l-2.2 2.75c-.326.326-.3.599-.3 1.106v18.629c0 .47.005.75.138.87L31.5 27z"></path></svg></span><span class="u-textScreenReader">Homepage</span></a></div></div></div><div class="metabar metabar--spacer js-metabarSpacer u-height65 u-xs-height56"></div><main role="main"><article class=" u-minHeight100vhOffset65 u-overflowHidden postArticle postArticle--full u-marginBottom40" lang="en"><header class="container u-maxWidth740"><div class="uiScale uiScale-ui--regular uiScale-caption--regular postMetaHeader u-paddingBottom10 row"><div class="col u-size12of12 js-postMetaLockup"><div class="uiScale uiScale-ui--regular uiScale-caption--regular postMetaLockup postMetaLockup--authorWithBio u-flexCenter js-postMetaLockup"><div class="u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@rantav?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="586fab9c92fd" data-action-type="hover" data-user-id="586fab9c92fd" dir="auto"><img src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/0_FtaU3aCLl7AOm9qe.jpg" class="avatar-image avatar-image--small" alt="Go to the profile of Ran Tavory"></a></div><div class="u-flex1 u-paddingLeft15 u-overflowHidden"><div class="u-lineHeightTightest"><a class="ds-link ds-link--styleSubtle ui-captionStrong u-inlineBlock link link--darken link--darker" href="https://medium.com/@rantav?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="586fab9c92fd" data-action-type="hover" data-user-id="586fab9c92fd" dir="auto">Ran Tavory</a><span class="followState js-followState" data-user-id="586fab9c92fd"><button class="button button--smallest u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-marginLeft10 u-xs-hide" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e" data-action-source="post_header_lockup"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--smallest u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton u-marginLeft10 u-xs-hide" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/586fab9c92fd" data-action-source="post_header_lockup-586fab9c92fd-------------------------follow_byline"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="ui-caption ui-xs-clamp2 postMetaInline">Founder yodas.com</div><div class="ui-caption postMetaInline js-testPostMetaInlineSupplemental"><time datetime="2016-08-02T18:42:34.903Z">Aug 3, 2016</time><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="14 min read"></span></div></div></div></div></div></header><div class="postArticle-content js-postField js-notesSource js-trackedPost" data-post-id="1be4b1b2871e" data-source="post_page" data-tracking-context="postPage" data-scroll="native"><section name="090f" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h1 name="2954" id="2954" class="graf graf--h3 graf--leading graf--title">Large scale matrix multiplication with pyspark (or — how to match two large datasets of company&nbsp;names)</h1><p name="a2e3" id="a2e3" class="graf graf--p graf-after--h3">Spark and pyspark have wonderful support for reliable distribution and parallelization of programs as well as support for many basic algebraic operations and machine learning algorithms.</p><p name="6e1d" id="6e1d" class="graf graf--p graf-after--p">In this post we describe the motivation and means of performing name-by-name matching of two large datasets of company names using Spark.</p><h3 name="ddc7" id="ddc7" class="graf graf--h3 graf-after--p">Motivation first</h3><p name="ed57" id="ed57" class="graf graf--p graf-after--h3">Our goal is to match two large sets of company names. We’re looking at two long lists of company names, list A and list B and we aim to match companies from A to companies from B.</p><p name="b5ec" id="b5ec" class="graf graf--p graf-after--p">Typically we would have something like this:</p><pre name="e490" id="e490" class="graf graf--pre graf-after--p">List A       | List B<br>---------------------<br>GOOGLE INC.  | Google<br>MEDIUM.COM   | Medium Inc<br>Amazon labs  | Amazon<br>Google, inc  |<br>Yahoo        |<br>             | Microsoft</pre><p name="ee9f" id="ee9f" class="graf graf--p graf-after--pre">In this example our goal is to match both GOOGLE INC. and Google, inc (from list A) to Google (from list B); and to match MEDIUM.COM to Medium Inc; and Amazon labs to Amazon, etc…</p><p name="df51" id="df51" class="graf graf--p graf-after--p">Looking at this simple example, a few things stand out:</p><ul class="postList"><li name="2226" id="2226" class="graf graf--li graf-after--p">It’s possible for more than one company from A to match a single company from B; it’s a many-to-one relationship.</li><li name="a6d2" id="a6d2" class="graf graf--li graf-after--li">Company names are in most cases easy for humans to match (e.g. Amazon labs to Amazon) but are not as easy for computers to match (how does the computer know that “labs” in this case is insignificant and that “Amazon” is just a short for “Amazon labs”?)</li><li name="9de1" id="9de1" class="graf graf--li graf-after--li">Not all companies from A have matches in B, and not all companies from B are matched from A. In our example Yahoo from list A is not matched to any other company on B and Microsoft from B is not matched to any company on A either.</li><li name="3e2b" id="3e2b" class="graf graf--li graf-after--li">Any element from list A should have at most one match from the B. The opposite isn’t true as noted, many companies from A could be matched into a single company on B.</li></ul><h3 name="627c" id="627c" class="graf graf--h3 graf-after--li">First attempt — trivial&nbsp;match</h3><p name="984f" id="984f" class="graf graf--p graf-after--h3">OK, At first we thought we’d try the most simple and trivial solution, to see how well it works, if not for anything else, at the very least in order to establish a baseline for future attempts. The most simple thing to do is just case-insensitive string equation test. Simply match the strings from A to the strings from B.</p><h4 name="c72c" id="c72c" class="graf graf--h4 graf-after--p">Precision and&nbsp;Recall</h4><p name="6f4e" id="6f4e" class="graf graf--p graf-after--h4">There are two relevant measures to look at: <em class="markup--em markup--p-em">Precision</em> and <em class="markup--em markup--p-em">Recall</em>. Precision is “how many mistakes did we (not) make”, or in other words — given all matches, how many of them were indeed correct matches — <em class="markup--em markup--p-em">Precise</em> matches. So precision is about <strong class="markup--strong markup--p-strong">false positives</strong>.</p><p name="aa99" id="aa99" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">Recall</em> on the other hand is “how many matches should have been found, but were missed”. So recall is about the <strong class="markup--strong markup--p-strong">false negatives</strong>.</p><p name="70d0" id="70d0" class="graf graf--p graf-after--p">The first trivial attempt was, as expected, high on precision but low on recall. If we look at out short list of example companies it would match <strong class="markup--strong markup--p-strong">zero</strong> elements from A to B. That’s very poor recall, but 100% precision&nbsp;;-). Of course in real-world scenario it would match a bit more than zero but it’s easy to see that due to many small possible variations in company names recall would remain low.</p><p name="e652" id="e652" class="graf graf--p graf-after--p">A simple improvement to that would be the <em class="markup--em markup--p-em">removal of stop-words</em>.</p><h4 name="f460" id="f460" class="graf graf--h4 graf-after--p">Stop Words</h4><p name="34b5" id="34b5" class="graf graf--p graf-after--h4">What are <em class="markup--em markup--p-em">stop-words</em>? <a href="https://en.wikipedia.org/wiki/Stop_words" data-href="https://en.wikipedia.org/wiki/Stop_words" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Stop-words</a> are words that get removed before processions various NLP algorithms because they don’t add information, usually they just add noise. In plain english stop-words are usually the “of”, “for” “if” etc of the language, these are very common words that get used a lot, but for many NLP and IR algorithms then don’t add information. They make for correct syntactical sentences and in many cases they affect the semantics, however at the level of many NLP processors, which don’t look at actual syntax, they are meaningless.</p><p name="0947" id="0947" class="graf graf--p graf-after--p">In our case the stop-words are not the “if”, “of” or “for” which are typical in English, but they are the “inc” and “llc” from the company extension. So our simple improvement is to just remove all these company extensions and try the simple string equation once again.</p><p name="2895" id="2895" class="graf graf--p graf-after--p">This indeed helped and as you can see in our example, this helped match “Google inc.” to “Google” and with simple punctuation removal and correct tokenization, we also match “Google<strong class="markup--strong markup--p-strong">,</strong> inc” to “Google”. But that still doesn’t match “Amazon labs” to “Amazon” b/c “labs” is not a stop-word in the sense that it isn’t not a <a href="http://www.corporateinformation.com/Company-Extensions-Security-Identifiers.aspx" data-href="http://www.corporateinformation.com/Company-Extensions-Security-Identifiers.aspx" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">common company extension</a>. As it turns out, “Amazon labs” isn’t just a random example, many company names have these variations in their names that are manifested in one dataset but are not manifested in other datasets. Conclusion: we have to find a way to “look beyond that”, ignore the “labs” in “Amazon labs”.</p><p name="ca93" id="ca93" class="graf graf--p graf-after--p">Let us meet science.</p><h3 name="4cdc" id="4cdc" class="graf graf--h3 graf-after--p">The Science</h3><p name="b16c" id="b16c" class="graf graf--p graf-after--h3">What we’re looking at here is the problem of matching N documents from list A to M documents in list B, in many-to-one relationship. But our matching algorithm needs to be “smart”, in the sense that it needs to be able to distinguish between “important words” and “non important words”. We need to find a way to tell the computer that “labs” in “amazon labs” is insignificant but “amazon” is indeed significant. We would also trivially tokenize the names into smaller tokens by splitting by spaces, punctuation etc, so that “medium.com” would get broken up into “medium” and “com”.</p><p name="26ba" id="26ba" class="graf graf--p graf-after--p">Science to the rescue!</p><h4 name="fe04" id="fe04" class="graf graf--h4 graf-after--p">TF-IDF</h4><p name="e914" id="e914" class="graf graf--p graf-after--h4">To that end we use a common scheme in information retrieval theory called <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf" data-href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">TF-IDF</a>. TF-IDF stands for Term Frequency — Inverted Document Frequency. Term Frequency simply means “how many times this word appears in this document” (our documents are just company names, so they are very short “documents”). So in the case of “amazon labs” we have only two words in the document “amazon” and “labs” and their frequency is simply 1 and 1. (If by the way the name of the company just happened to be “amazon labs amazon” then the count would have been 2 for “amazon” and 1 for “labs”.) That’s what TF is all about, quite simple: Count the frequency of terms in the document.</p><p name="fdb2" id="fdb2" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">Inverted Document Frequency</em> is the real deal. The inverted document frequency looks at all “documents” (aka <em class="markup--em markup--p-em">corpus</em>, all the company names) and tests how often the word “labs” appears in all of them. If the word “amazon” only appears in a single document, that means that “amazon” is a significant word, but if the word “labs” appears in many other documents (e.g. many companies use the word “labs” as part of their name) then that means that the word “labs” is insignificant. IDF is just that — how many documents does the word appear in.</p><p name="6aca" id="6aca" class="graf graf--p graf-after--p">TF-IDF is TF of the term, divided by the term’s IDF. It provides a good measurement of how important or how significant words are in the context of specific documents.</p><p name="8bb2" id="8bb2" class="graf graf--p graf-after--p">It’s easy to compute the TF-IDF matrix for a set of documents. There are ready-made libraries that do that, and we used <a href="http://scikit-learn.org/stable/modules/feature_extraction.html#tfidf-term-weighting" data-href="http://scikit-learn.org/stable/modules/feature_extraction.html#tfidf-term-weighting" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">scikit-learn’s implementation</a> for that.</p><p name="7f71" id="7f71" class="graf graf--p graf-after--p">The TF-IDF matrix is a two dimensional matrix in which the rows represent documents (in our case — company names) and the columns represent unique tokens (or words). If we wanted to build the TF-IDF matrix of our little corpus from list A it’d look something like this (after the removal of stop-words, punctuation and lowercasing everything):</p><pre name="935c" id="935c" class="graf graf--pre graf-after--p">           | google | medium | com | yahoo | amazon | labs <br>-----------------------------------------------------------<br>GOOGLE INC.|   1         0      0      0        0      0<br>MEDIUM.COM |   0        .77    .63     0        0      0<br>Amazon labs|   0         0      0      0        .7     .7<br>Google, inc|   1         0      0      0        0      0<br>Yahoo      |   0         0      0      1        0      0<br>com        |   0         0      1      0        0      0</pre><p name="ff9d" id="ff9d" class="graf graf--p graf-after--pre">Here’s the code:</p><pre name="715e" id="715e" class="graf graf--pre graf-after--p">from sklearn.feature_extraction.text import TfidfVectorizer</pre><pre name="a2cf" id="a2cf" class="graf graf--pre graf-after--pre">matrix = vectorizer.fit_transform(['GOOGLE','MEDIUM.COM', 'Amazon labs', 'Google', 'Yahoo', 'com'])</pre><p name="cb73" id="cb73" class="graf graf--p graf-after--pre">The matrix that was created is NxM where N = number of companies and M = number of unique tokens.</p><p name="5288" id="5288" class="graf graf--p graf-after--p">You’d notice that we added another (made up) company named “com”. We did that in order to demonstrate an important property of TF-IDF. We use TF-IDF in order to distinguish between significant and insignificant tokens in the documents. A significant token in a document is a token that not only appears in the document often, but that is also relatively rare in the entire corpus. If a term appears many times in the corpus then it becomes less significant for this specific document. We added the made up company “com” so that ”Medium” within “Medium.com” becomes more significant. (You’d notice that “Medium” weight is&nbsp;.77 while “com” weight is&nbsp;.63, and that’s due to the appearance of “com” in another document hence it’s IDF is lower).</p><p name="e8e7" id="e8e7" class="graf graf--p graf-after--p">Of course in real world situation you’d have dozens or hundreds of company names with the token “com” or “labs” so you’d see a substantial difference between “Medium” and “com” within the name Medium.com.</p><h4 name="1361" id="1361" class="graf graf--h4 graf-after--p">Cosine Similarity</h4><p name="0ae5" id="0ae5" class="graf graf--p graf-after--h4">The next step after calculating the TF-IDF matrix for both sides (both lists A and B of companies) is to <strong class="markup--strong markup--p-strong">multiply the matrices</strong>.</p><p name="a045" id="a045" class="graf graf--p graf-after--p">Multiplying matrices provides an interesting measure called the <a href="https://en.wikipedia.org/wiki/Cosine_similarity" data-href="https://en.wikipedia.org/wiki/Cosine_similarity" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank"><em class="markup--em markup--p-em">Cosine Similarity</em></a>. The cosine similarity is a simple similarity measurement that ranges between 0 and 1. A value of 1 indicates identical elements and a velue of 0 indicates completely different elements (just like the cosine trig function does). Multiplying the matrices provides the cosine similarity between every element in list A to every element in list B. As a matter of fact, we multiply A by B.T (B.transpose) so that the dimensions fit. The interesting thing about cosine similarity between TF-IDF matrices is that the result is a matrix of similarities between every element in A to every element in B, while taking into account the significance of tokens in the names. Usually a result of &gt;&nbsp;.8 means a valid match.</p><p name="b6a9" id="b6a9" class="graf graf--p graf-after--p">Luckily the python package <em class="markup--em markup--p-em">sklearn</em> provides a simple <em class="markup--em markup--p-em">cosine_similarity</em> function that accepts two matrices and results in the cosine similarity of these two. Here’s some demo code:</p><pre name="13d3" id="13d3" class="graf graf--pre graf-after--p">from sklearn.feature_extraction.text import TfidfVectorizer<br>from sklearn.metrics.pairwise import cosine_similarity</pre><pre name="19b3" id="19b3" class="graf graf--pre graf-after--pre">a = vectorizer.fit_transform(['aa','bb', 'aa bb', 'aa aa bb'])<br>b = vectorizer.fit_transform(['aa', 'bb'])<br>cosimilarities = cosine_similarity(a, b)</pre><p name="610e" id="610e" class="graf graf--p graf-after--pre">The result is a matrix of similarities between every element in A to every element in b.</p><pre name="196c" id="196c" class="graf graf--pre graf-after--p">           aa   |  bb<br>----------------------<br>aa       | 1    |  0 <br>bb       | 0    |  1<br>aa bb    | .7   |  .7<br>aa aa bb | .89  |  .44</pre><p name="10be" id="10be" class="graf graf--p graf-after--pre">As expected, the word “aa” from a is very similar to the word “aa” from b (note the 1). You can also see that “aa bb” is equally similar to both “aa” and “bb” and that also makes sense. And finally you’d notice that “aa aa bb” bares higher similarity to “aa” than it does to “bb”. This all makes sense.</p><p name="45b5" id="45b5" class="graf graf--p graf-after--p">Let us sum up the science here. First we take two lists of documents and for each set we compute it’s TF-IDF matrix*. Then we multiply the two matrices to come up with their cosine similarity, which is a matrix that describes the similarity between every document in A to every document in B.</p><h3 name="3410" id="3410" class="graf graf--h3 graf-after--p">Second Attempt — numpy matrix multiplication</h3><p name="4ac5" id="4ac5" class="graf graf--p graf-after--h3">After having seen the science, we want to try this in practice. The next attempt is to load all real companies from list A and load all real companies from list B and multiply the heck out of them using the function <em class="markup--em markup--p-em">cosine_similatiry</em>.</p><p name="13d1" id="13d1" class="graf graf--p graf-after--p">Easier said than done.</p><p name="4323" id="4323" class="graf graf--p graf-after--p">In small scale this simply works and it works very nicely. For example with a few thousand companies on each side that would work. However with our dataset, in which we have a couple of hundred of thousands names in each list, up to a few millions, this becomes challenging.</p><p name="1312" id="1312" class="graf graf--p graf-after--p">Simply calculating the TF-IDF is feasible, even with such large datasets, on a single host (my laptop runs that easily, in a few seconds). However, multiplying the matrices is where the real challenge is.</p><h4 name="bc8b" id="bc8b" class="graf graf--h4 graf-after--p">Local multiplication doesn’t&nbsp;scale</h4><p name="0eb2" id="0eb2" class="graf graf--p graf-after--h4">Let’s assume we have 1M (10⁶) names in each list. Each matrix then would be about the order of 10⁶ x 10⁶ (since the number of unique tokens is similar in order to the number of companies due to uniqueness of names). Creating a 10⁶ x 10⁶ matrix in memory means 10¹² floats. A python float takes 16 bytes so we end up with 16*10¹² bytes, which translates to ~4PT (four petabytes) of RAM. Can we keep a 4PT matrix in memory? Well, of course not, at least not on my shabby laptop. But — there’s a trick. <em class="markup--em markup--p-em">We don’t have to keep it all in memory</em>. Keep in mind that although the matrix is 1M on 1M, in practice it is <strong class="markup--strong markup--p-strong">mostly filled with Zeros</strong>. So, why should we bother maintaining all these zeros in memory? We can instead use a <em class="markup--em markup--p-em">sparse</em> representation of the matrix, in which instead of keeping the two dimensional matrix in memory using arrays of arrays, we can instead only keep track of the coordinates of the non-zero elements and assume that all the rest are just zeros. That’s great for preserving low memory footprint as well as executing fast matrix multiplication operations. And as a matter of fact, this is exactly what sklearn already does. Keeping the matrices as Sparse Matrices means that we only have to allocate around 1M floats (values), plus 2M integers (indices of non-zero elements), but all in all it’s about 24Mbytes, which is quite easy.</p><p name="81e8" id="81e8" class="graf graf--p graf-after--p">But — multiplying the two matrices, even that they are sparse, would mean at the very least 10¹² operations (if we’re smart with the zeros). Now that is a bit harder. And although numpy (which lies underneath sklearn) is very good at such fast math, this thing is a bit challenging even for numpy.</p><p name="3b7a" id="3b7a" class="graf graf--p graf-after--p">We tried that — simply multiplying these two matrices. It works well for small enough matrix size, but at some numbers (which are much smaller than what we want) it started to fail and run out of memory. Now, we could’ve worked this out by splitting one of the matrices to smaller chunks and running a number or multiplications one after the other and then summing all things up. But, this kind of reminded us that we already know that kind of system that does that, it’s called Spark.</p><h3 name="778d" id="778d" class="graf graf--h3 graf-after--p">Third Attempt — Spark matrix multiplication</h3><p name="2a0c" id="2a0c" class="graf graf--p graf-after--h3"><a href="https://spark.apache.org/" data-href="https://spark.apache.org/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Spark</a> is great for highly parallelized memory intensive computations and lo and behold, it has a <a href="https://spark.apache.org/docs/1.6.2/api/python/pyspark.mllib.html#pyspark.mllib.linalg.distributed.BlockMatrix" data-href="https://spark.apache.org/docs/1.6.2/api/python/pyspark.mllib.html#pyspark.mllib.linalg.distributed.BlockMatrix" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">BlockMatrix</a> data type which implements a <a href="https://spark.apache.org/docs/1.6.2/api/python/pyspark.mllib.html#pyspark.mllib.linalg.distributed.BlockMatrix.multiply" data-href="https://spark.apache.org/docs/1.6.2/api/python/pyspark.mllib.html#pyspark.mllib.linalg.distributed.BlockMatrix.multiply" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">multiply</a> operation. Looks like exactly what we were looking for! OK, so we create the TF-IDF matrices and convert them to Spark’s BlockMatrix and run <em class="markup--em markup--p-em">a.multiply(b.transpose())</em> which is more or less what cosine_similatiry does.</p><pre name="7ce4" id="7ce4" class="graf graf--pre graf-after--p"># Pseudocode...</pre><pre name="2653" id="2653" class="graf graf--pre graf-after--pre">a_mat = tfidf_vect.fit_transform([..., ..., ...])<br>b_mat = tfidf_vect.fit_transform([..., ..., ...])</pre><pre name="34a1" id="34a1" class="graf graf--pre graf-after--pre">a_block_mat = create_block_matrix(a)<br>b_block_mat_tr = create_block_matrix(b.transpose())</pre><pre name="ab3e" id="ab3e" class="graf graf--pre graf-after--pre">cosimilarities = a_block_mat.multiply(b_block_mat_tr)</pre><p name="9cab" id="9cab" class="graf graf--p graf-after--pre">This seems easy enough, and it really is. But there’s a “but” of course… this thing, although simple and works correctly from the math point of view — well, it doesn’t scale… We’re able to multiply large matrices, but not as large as we would like to. We tried playing with the block sizes etc alas, for large enough inputs it fails with either out-of-memory errors or just long runs that never end (hours and hours).</p><p name="1d34" id="1d34" class="graf graf--p graf-after--p">What’s the problem? Can’t Spark scale?</p><p name="3a9a" id="3a9a" class="graf graf--p graf-after--p">Of course spark can scale. But you have to use it wisely, stupid... The problem with BlockMatrix is that in order to implement the multiply operation Spark converts the sparse blocks of the matrix into <em class="markup--em markup--p-em">dense</em> (sub)matrices. And although most of our matrix is zeros, spark would still convert all these zeros into dense representation, which would either consume too much memory, or if we keep the size of the blocks small, would result in too many operations, repartitions etc and run forever.</p><p name="cef5" id="cef5" class="graf graf--p graf-after--p">Spark does support sparse matrices, but these matrices do not implement the <em class="markup--em markup--p-em">multiply</em> (aka <em class="markup--em markup--p-em">dot</em>) operation, and the only distributed matrix that does implement the multiply operation as of the time of writing is the BlockMatrix, which as noted, converts the sparse representation into dense representation before multiplying them. We should note that there had been discussions in the spark community about ways to implement distributed sparse matrix multiplication, however as noted — at the time of this writing, this was not implemented yet.</p><p name="c196" id="c196" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">BlockMatrix.multiply()</em> failed. What’s next?</p><h3 name="6dd0" id="6dd0" class="graf graf--h3 graf-after--p">Fourth Attempt — and the winner&nbsp;is…</h3><p name="0b4a" id="0b4a" class="graf graf--p graf-after--h3">Our fourth and last attempt was successful. The idea is to mix and match Spark with numpy. Our tests show that numpy is able to multiply a smaller matrix with a larger matrix, so if we take just a small chunk of matrix A and multiply that by matrix B, that would work and numpy would not explode. And if you recall your algebra lessons, multiplying matrices can be done vector-by-vector so algebraic-wise that would still be correct. The idea is to <em class="markup--em markup--p-em">split just one of the matrices</em> into smaller pieces, and then have each Spark worker run the multiply on its chunk, and then return just the conclusion, e.g. the conclusion might be that the name at A[13] matches the name at B[21] etc.</p><h4 name="c462" id="c462" class="graf graf--h4 graf-after--p">Broadcast and Parallelize to the&nbsp;rescue</h4><p name="d6c8" id="d6c8" class="graf graf--p graf-after--h4">Spark has two useful capabilities: <em class="markup--em markup--p-em">broadcast</em> and <em class="markup--em markup--p-em">parallelize</em>. <strong class="markup--strong markup--p-strong">Broadcast</strong> simply broadcasts the exact same data to all the workers. We use broadcast to send matrix B to all workers so that all workers have the complete B matrix. <strong class="markup--strong markup--p-strong">Parallelize</strong> chunks the data into partitions and sends each partition to a different worker. We use parallelize to send <em class="markup--em markup--p-em">chunks of A</em> to the workers so that each worker has all of B but just a small chunk of A.</p><p name="0993" id="0993" class="graf graf--p graf-after--p">Here’s the general outline:</p><ol class="postList"><li name="5526" id="5526" class="graf graf--li graf-after--p">Calculate TF-IDF matrices on the driver.</li><li name="cead" id="cead" class="graf graf--li graf-after--li">Parallelize matrix A; Broadcast matrix B</li><li name="dfda" id="dfda" class="graf graf--li graf-after--li">Each worker now f<em class="markup--em markup--li-em">latMap</em>s its chunk of work by multiplying its chunk of matrix A with the entire matrix B. So if a worker operates on A[0:99] then it would multiply these hundred rows and return the result of, say A[13] matches a name found in B[21]. Multiplication is done using numpy.</li><li name="3d3a" id="3d3a" class="graf graf--li graf-after--li">The driver would collect back all the results from the different workers and match the indices (A[13] and B[21]) to the actual names in the original dataset — and we’re done!</li></ol><p name="1bc5" id="1bc5" class="graf graf--p graf-after--li">This method works very well and as a matter of fact when it ran for the first time it was such a nice surprise that we thought it just didn’t work (but it did…). Compared to the previous methods, which either ran for hours (and didn’t finish) or ran out or memory, this method was able to complete its computation in order of just a few minutes. Of course it depends on the size of the data and the size of Spark’s cluster, but all in all it performed really well.</p><p name="c501" id="c501" class="graf graf--p graf-after--p">Right now the only bottleneck is the driver calculating TF-IDF matrices and on that front we still have tons of elbow space because this calculation is still quite easy for sklearn. (side-note: Spark also implements distributed TF-IDF calculation but we didn’t have to use it).</p><p name="3ff6" id="3ff6" class="graf graf--p graf-after--p">Here’s pseudocode to illustrate our solution:</p><pre name="3358" id="3358" class="graf graf--pre graf-after--p">from sklearn.feature_extraction.text import TfidfVectorizer<br>from sklearn.feature_extraction.text import CountVectorizer<br>from sklearn.metrics.pairwise import cosine_similarity</pre><pre name="0982" id="0982" class="graf graf--pre graf-after--pre"># these would realistically get read from files or dataframes. <br>a = ['google inc', 'medium.com', ...] <br>b = ['google', 'microsoft', ...]<br>stopwords = ['ltd', ...]<br>vect = CountVectorizer(stop_words=stopwords)<br># this can be done with less memory overhead by using a generator<br>vocabulary =  vect.fit(a + b).vocabulary_<br>tfidf_vect = TfidfVectorizer(stop_words=stopwords,<br>                             vocabulary=vocabulary)<br>a_mat = tfidf_vect.fit_transform(a)<br>b_mat = tfidf_vect.fit_transform(b)</pre><pre name="bb28" id="bb28" class="graf graf--pre graf-after--pre">a_mat_para = parallelize_matrix(a_mat, rows_per_chunk=100)<br>b_mat_dist = broadcast_matrix(a_mat)<br>a_mat_para.flatMap(<br>        lambda submatrix:<br>        find_matches_in_submatrix(csr_matrix(submatrix[1],<br>                                             shape=submatrix[2]),<br>                                   b_mat_dist,<br>                                   submatrix[0]))</pre><pre name="6b03" id="6b03" class="graf graf--pre graf-after--pre">def find_matches_in_submatrix(sources, targets, inputs_start_index,<br>                              threshold=.8):<br>    cosimilarities = cosine_similarity(sources, targets)<br>    for i, cosimilarity in enumerate(cosimilarities):<br>        cosimilarity = cosimilarity.flatten()<br>        # Find the best match by using argsort()[-1]<br>        target_index = cosimilarity.argsort()[-1]<br>        source_index = inputs_start_index + i<br>        similarity = cosimilarity[target_index]<br>        if cosimilarity[target_index] &gt;= threshold:<br>            yield (source_index, target_index, similarity)</pre><pre name="f442" id="f442" class="graf graf--pre graf-after--pre">def broadcast_matrix(mat):<br>    bcast = sc.<strong class="markup--strong markup--pre-strong">broadcast</strong>((mat.data, mat.indices, mat.indptr))<br>    (data, indices, indptr) = bcast.value<br>    bcast_mat = csr_matrix((data, indices, indptr), shape=mat.shape)<br>    return bcast_mat</pre><pre name="4d60" id="4d60" class="graf graf--pre graf-after--pre">def parallelize_matrix(scipy_mat, rows_per_chunk=100):<br>    [rows, cols] = scipy_mat.shape<br>    i = 0<br>    submatrices = []<br>    while i &lt; rows:<br>        current_chunk_size = min(rows_per_chunk, rows - i)<br>        submat = scipy_mat[i:i + current_chunk_size]<br>        submatrices.append((i, (submat.data, submat.indices, <br>                                submat.indptr),<br>                            (current_chunk_size, cols)))<br>        i += current_chunk_size<br>    return sc.<strong class="markup--strong markup--pre-strong">parallelize</strong>(submatrices)</pre><p name="4949" id="4949" class="graf graf--p graf-after--pre">You’d notice that after the broadcast and parallelize, we re-assemble the matrix into scipy <em class="markup--em markup--p-em">csr_matrix</em>, which is what it originated from. So what we basically do is — we serialize the matrices over the wire and then reassemble them on the other side, on the workers. The serialization is efficient since we only need to send the non-zero elements of the sparse matrix. So for a matrix of 1M elements we only send about 1M floats, along with 2M ints, which is definitely in the comfort zone of Spark.</p><h3 name="a27b" id="a27b" class="graf graf--h3 graf-after--p">Conclusion</h3><p name="0a0b" id="0a0b" class="graf graf--p graf-after--h3">We describe a method for finding similarity between two lists of strings A and B which describe company names. We used TF-IDF and cosine-similarity as a similarity factor.</p><p name="3d43" id="3d43" class="graf graf--p graf-after--p graf--trailing">Next we show various attempts for scalable implementation of matrix multiplication using spark, and the winning method which combines numpy matrix multiplication along with spark’s broadcast and parallelize capabilities.</p></div></div></section><section name="86c2" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="5241" id="5241" class="graf graf--p graf--leading">* One fine point to mention: the vocabulary of both matrices must be the same. In other words the number of rows in both matrices must be equal and they must have exactly the same order e.g. each row represents a term and the order of the rows must be exactly the same between matrix A and matrix B. This is easily done by first calculating the vocabulary and only then calculating the TF-IDF as in the following example:</p><pre name="7ff4" id="7ff4" class="graf graf--pre graf-after--p">from sklearn.feature_extraction.text import TfidfVectorizer<br>from sklearn.feature_extraction.text import CountVectorizer<br>from sklearn.metrics.pairwise import cosine_similarity</pre><pre name="b682" id="b682" class="graf graf--pre graf-after--pre graf--trailing">a = ['google inc', 'medium.com']<br>b = ['google', 'microsoft']<br>company_name_stopwords = frozenset(['ltd', 'llc', 'inc'])<br>vect = CountVectorizer(stop_words=company_name_stopwords)<br><strong class="markup--strong markup--pre-strong">vocabulary =  vect.fit(a + b).vocabulary_<br></strong>tfidf_vect = TfidfVectorizer(stop_words=company_name_stopwords,<br>                             <strong class="markup--strong markup--pre-strong">vocabulary=vocabulary</strong>)<br>a_mat = tfidf_vect.fit_transform(a)<br>b_mat = tfidf_vect.fit_transform(b)<br>cosimilarities = cosine_similarity(a_mat, b_mat)</pre></div></div></section></div><footer class="u-paddingTop10"><div class="container u-maxWidth740"><div class="row"><div class="col u-size12of12"></div></div><div class="row"><div class="col u-size12of12 js-postTags"><div class="u-paddingBottom10"><ul class="tags tags--postTags tags--borderless"><li><a class="link u-baseColor--link" href="https://medium.com/tag/data-science?source=post" data-action-source="post">Data Science</a></li><li><a class="link u-baseColor--link" href="https://medium.com/tag/machine-learning?source=post" data-action-source="post">Machine Learning</a></li></ul></div></div></div><section class="uiScale uiScale-ui--small uiScale-caption--regular u-borderTopLightest u-marginTop10 u-paddingTop20"><div class="ui-h3 u-textColorDarker u-fontSize22">Like what you read? Give Ran Tavory a round of applause.</div><p class="ui-body u-marginBottom20 u-textColorDark u-fontSize16">From a quick cheer to a standing ovation, clap to show how much you enjoyed this story.</p></section><div class="postActions js-postActionsFooter"><div class="u-flexCenter"><div class="u-flex1"><div class="multirecommend js-actionMultirecommend u-flexCenter u-width60" data-post-id="1be4b1b2871e" data-is-icon-29px="true" data-is-circle="true" data-has-recommend-list="true" data-source="post_actions_footer-----1be4b1b2871e---------------------clap_footer"><div class="u-relative u-foreground"><button class="button button--large button--circle button--withChrome u-baseColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton clapButton--largePill u-relative u-foreground u-xs-paddingLeft13 u-width60 u-height60 u-accentColor--textNormal u-accentColor--buttonNormal clap-onboarding" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/1be4b1b2871e" data-action-source="post_actions_footer-----1be4b1b2871e---------------------clap_footer" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33" viewBox="0 0 33 33"><path d="M28.86 17.342l-3.64-6.402c-.292-.433-.712-.729-1.163-.8a1.124 1.124 0 0 0-.889.213c-.63.488-.742 1.181-.33 2.061l1.222 2.587 1.4 2.46c2.234 4.085 1.511 8.007-2.145 11.663-.26.26-.526.49-.797.707 1.42-.084 2.881-.683 4.292-2.094 3.822-3.823 3.565-7.876 2.05-10.395zm-6.252 11.075c3.352-3.35 3.998-6.775 1.978-10.469l-3.378-5.945c-.292-.432-.712-.728-1.163-.8a1.122 1.122 0 0 0-.89.213c-.63.49-.742 1.182-.33 2.061l1.72 3.638a.502.502 0 0 1-.806.568l-8.91-8.91a1.335 1.335 0 0 0-1.887 1.886l5.292 5.292a.5.5 0 0 1-.707.707l-5.292-5.292-1.492-1.492c-.503-.503-1.382-.505-1.887 0a1.337 1.337 0 0 0 0 1.886l1.493 1.492 5.292 5.292a.499.499 0 0 1-.353.854.5.5 0 0 1-.354-.147L5.642 13.96a1.338 1.338 0 0 0-1.887 0 1.338 1.338 0 0 0 0 1.887l2.23 2.228 3.322 3.324a.499.499 0 0 1-.353.853.502.502 0 0 1-.354-.146l-3.323-3.324a1.333 1.333 0 0 0-1.886 0 1.325 1.325 0 0 0-.39.943c0 .356.138.691.39.943l6.396 6.397c3.528 3.53 8.86 5.313 12.821 1.353zM12.73 9.26l5.68 5.68-.49-1.037c-.518-1.107-.426-2.13.224-2.89l-3.303-3.304a1.337 1.337 0 0 0-1.886 0 1.326 1.326 0 0 0-.39.944c0 .217.067.42.165.607zm14.787 19.184c-1.599 1.6-3.417 2.392-5.353 2.392-.349 0-.7-.03-1.058-.082a7.922 7.922 0 0 1-3.667.887c-3.049 0-6.115-1.626-8.359-3.87l-6.396-6.397A2.315 2.315 0 0 1 2 19.724a2.327 2.327 0 0 1 1.923-2.296l-.875-.875a2.339 2.339 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.647l-.139-.139c-.91-.91-.91-2.39 0-3.3.884-.884 2.421-.882 3.301 0l.138.14a2.335 2.335 0 0 1 3.948-1.24l.093.092c.091-.423.291-.828.62-1.157a2.336 2.336 0 0 1 3.3 0l3.384 3.386a2.167 2.167 0 0 1 1.271-.173c.534.086 1.03.354 1.441.765.11-.549.415-1.034.911-1.418a2.12 2.12 0 0 1 1.661-.41c.727.117 1.385.565 1.853 1.262l3.652 6.423c1.704 2.832 2.025 7.377-2.205 11.607zM13.217.484l-1.917.882 2.37 2.837-.454-3.719zm8.487.877l-1.928-.86-.44 3.697 2.368-2.837zM16.5 3.293L15.478-.005h2.044L16.5 3.293z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33" viewBox="0 0 33 33"><g fill-rule="evenodd"><path d="M29.58 17.1l-3.854-6.78c-.365-.543-.876-.899-1.431-.989a1.491 1.491 0 0 0-1.16.281c-.42.327-.65.736-.7 1.207v.001l3.623 6.367c2.46 4.498 1.67 8.802-2.333 12.807-.265.265-.536.505-.81.728 1.973-.222 3.474-1.286 4.45-2.263 4.166-4.165 3.875-8.6 2.215-11.36zm-4.831.82l-3.581-6.3c-.296-.439-.725-.742-1.183-.815a1.105 1.105 0 0 0-.89.213c-.647.502-.755 1.188-.33 2.098l1.825 3.858a.601.601 0 0 1-.197.747.596.596 0 0 1-.77-.067L10.178 8.21c-.508-.506-1.393-.506-1.901 0a1.335 1.335 0 0 0-.393.95c0 .36.139.698.393.95v.001l5.61 5.61a.599.599 0 1 1-.848.847l-5.606-5.606c-.001 0-.002 0-.003-.002L5.848 9.375a1.349 1.349 0 0 0-1.902 0 1.348 1.348 0 0 0 0 1.901l1.582 1.582 5.61 5.61a.6.6 0 0 1-.848.848l-5.61-5.61c-.51-.508-1.393-.508-1.9 0a1.332 1.332 0 0 0-.394.95c0 .36.139.697.393.952l2.363 2.362c.002.001.002.002.002.003l3.52 3.52a.6.6 0 0 1-.848.847l-3.522-3.523h-.001a1.336 1.336 0 0 0-.95-.393 1.345 1.345 0 0 0-.949 2.295l6.779 6.78c3.715 3.713 9.327 5.598 13.49 1.434 3.527-3.528 4.21-7.13 2.086-11.015zM11.817 7.727c.06-.328.213-.64.466-.893.64-.64 1.755-.64 2.396 0l3.232 3.232c-.82.783-1.09 1.833-.764 2.992l-5.33-5.33z"></path><path d="M13.285.48l-1.916.881 2.37 2.837z"></path><path d="M21.719 1.361L19.79.501l-.44 3.697z"></path><path d="M16.502 3.298L15.481 0h2.043z"></path></g></svg></span></span></button><div class="clapUndo u-width60 u-round u-height32 u-absolute u-borderBox u-paddingRight5 u-transition--transform200Spring u-background--brandSageLighter js-clapUndo" style="top: 14px; padding: 2px;"><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon u-floatRight" data-action="multivote-undo" data-action-value="1be4b1b2871e"><span class="svgIcon svgIcon--removeThin svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M20.13 8.11l-5.61 5.61-5.609-5.61-.801.801 5.61 5.61-5.61 5.61.801.8 5.61-5.609 5.61 5.61.8-.801-5.609-5.61 5.61-5.61" fill-rule="evenodd"></path></svg></span></button></div></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft10"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton" data-action="show-recommends" data-action-value="1be4b1b2871e">97</button></span></div></div><div class="buttonSet u-flex0"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon" data-action="scroll-to-responses" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--response svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M21.27 20.058c1.89-1.826 2.754-4.17 2.754-6.674C24.024 8.21 19.67 4 14.1 4 8.53 4 4 8.21 4 13.384c0 5.175 4.53 9.385 10.1 9.385 1.007 0 2-.14 2.95-.41.285.25.592.49.918.7 1.306.87 2.716 1.31 4.19 1.31.276-.01.494-.14.6-.36a.625.625 0 0 0-.052-.65c-.61-.84-1.042-1.71-1.282-2.58a5.417 5.417 0 0 1-.154-.75zm-3.85 1.324l-.083-.28-.388.12a9.72 9.72 0 0 1-2.85.424c-4.96 0-8.99-3.706-8.99-8.262 0-4.556 4.03-8.263 8.99-8.263 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32c0 .07 0 .19.02.37.03.29.1.6.19.92.19.7.49 1.4.89 2.08-.93-.14-1.83-.49-2.67-1.06-.34-.22-.88-.48-1.16-.74z"></path></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal" data-action="scroll-to-responses">5</button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon u-xs-hide" title="Share on Twitter" aria-label="Share on Twitter" data-action="share-on-twitter" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--twitter svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"></path></svg></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon u-xs-hide" title="Share on Facebook" aria-label="Share on Facebook" data-action="share-on-facebook" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--facebook svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"></path></svg></span></button><button class="button button--large button--dark button--chromeless u-baseColor--buttonDark button--withIcon button--withSvgIcon u-xs-show" title="Share this story on Twitter or Facebook" aria-label="Share this story on Twitter or Facebook" data-action="show-share-popover" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--share svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M20.385 8H19a.5.5 0 1 0 .011 1h1.39c.43 0 .84.168 1.14.473.31.305.48.71.48 1.142v10.77c0 .43-.17.837-.47 1.142-.3.305-.71.473-1.14.473H8.62c-.43 0-.84-.168-1.144-.473a1.603 1.603 0 0 1-.473-1.142v-10.77c0-.43.17-.837.48-1.142A1.599 1.599 0 0 1 8.62 9H10a.502.502 0 0 0 0-1H8.615c-.67 0-1.338.255-1.85.766-.51.51-.765 1.18-.765 1.85v10.77c0 .668.255 1.337.766 1.848.51.51 1.18.766 1.85.766h11.77c.668 0 1.337-.255 1.848-.766.51-.51.766-1.18.766-1.85v-10.77c0-.668-.255-1.337-.766-1.848A2.61 2.61 0 0 0 20.384 8zm-8.67-2.508L14 3.207v8.362c0 .27.224.5.5.5s.5-.23.5-.5V3.2l2.285 2.285a.49.49 0 0 0 .704-.001.511.511 0 0 0 0-.708l-3.14-3.14a.504.504 0 0 0-.71 0L11 4.776a.501.501 0 0 0 .71.706" fill-rule="evenodd"></path></svg></span></button></div></div></div></div><div class="u-maxWidth740 u-paddingTop20 u-marginTop20 u-borderTopLightest container u-paddingBottom20 u-xs-paddingBottom10 js-postAttributionFooterContainer"><div class="row js-postFooterInfo"><div class="col u-size12of12"><li class="uiScale uiScale-ui--small uiScale-caption--regular u-block u-paddingBottom18 js-cardUser"><div class="u-marginLeft20 u-floatRight"><span class="followState js-followState" data-user-id="586fab9c92fd"><button class="button button--small u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e" data-action-source="footer_card"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/586fab9c92fd" data-action-source="footer_card-586fab9c92fd-------------------------follow_footer"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="u-tableCell"><a class="link u-baseColor--link avatar" href="https://medium.com/@rantav?source=footer_card" title="Go to the profile of Ran Tavory" aria-label="Go to the profile of Ran Tavory" data-action-source="footer_card" data-user-id="586fab9c92fd" dir="auto"><img src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/0_FtaU3aCLl7AOm9qe.jpg" class="avatar-image avatar-image--small" alt="Go to the profile of Ran Tavory"></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="ui-h3 u-fontSize18 u-lineHeightTighter u-marginBottom4"><a class="link link--primary u-accentColor--hoverTextNormal" href="https://medium.com/@rantav" property="cc:attributionName" title="Go to the profile of Ran Tavory" aria-label="Go to the profile of Ran Tavory" rel="author cc:attributionUrl" data-user-id="586fab9c92fd" dir="auto">Ran Tavory</a></h3><p class="ui-body u-fontSize14 u-lineHeightBaseSans u-textColorDark u-marginBottom4">Founder yodas.com</p></div></li></div></div></div><div class="js-postFooterPlacements"><div class="streamItem streamItem--placementCardGrid js-streamItem"><div class="u-clearfix u-backgroundGrayLightest"><div class="row u-marginAuto u-maxWidth1000 u-paddingTop30 u-paddingBottom40"><div class="col u-padding8 u-xs-size12of12 u-size4of12"><div class="uiScale uiScale-ui--small uiScale-caption--regular u-height280 u-sizeFullWidth u-backgroundWhite u-borderCardBorder u-boxShadow u-borderBox u-borderRadius4 js-trackedPost" data-post-id="f7335fb1f84f" data-source="placement_card_footer_grid---------0-43" data-tracking-context="placement" data-scroll="native"><a class="link link--noUnderline u-baseColor--link" href="https://towardsdatascience.com/five-books-every-data-scientist-should-read-that-are-not-about-data-science-f7335fb1f84f?source=placement_card_footer_grid---------0-43" data-action-source="placement_card_footer_grid---------0-43"><div class="u-backgroundCover u-backgroundColorGrayLight u-height100 u-sizeFullWidth u-borderBottomLight u-borderRadiusTop4" style="background-image: url(&quot;https://cdn-images-1.medium.com/fit/c/400/120/1*1RivATtf-HPn1GcI3p3tNw.jpeg&quot;); background-position: 50% 50% !important;"></div></a><div class="u-padding15 u-borderBox u-flexColumn u-height180"><a class="link link--noUnderline u-baseColor--link u-flex1" href="https://towardsdatascience.com/five-books-every-data-scientist-should-read-that-are-not-about-data-science-f7335fb1f84f?source=placement_card_footer_grid---------0-43" data-action-source="placement_card_footer_grid---------0-43"><div class="uiScale uiScale-ui--regular uiScale-caption--small u-textColorNormal u-marginBottom7">Also tagged Machine Learning</div><div class="ui-h3 ui-clamp2 u-textColorDarkest u-contentSansBold u-fontSize24 u-maxHeight2LineHeightTighter u-lineClamp2 u-textOverflowEllipsis u-letterSpacingTight u-paddingBottom2">Five books every data scientist should read that are not about data science</div></a><div class="u-paddingBottom10 u-flex0 u-flexCenter"><div class="u-flex1 u-minWidth0 u-marginRight10"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://towardsdatascience.com/@isaacfaber" data-action="show-user-card" data-action-value="81d6b9acba62" data-action-type="hover" data-user-id="81d6b9acba62" data-collection-slug="towards-data-science" dir="auto"><img src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/1_oQEv0ES7AUPNp-zPsIOKkw.jpeg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Isaac Faber"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--darker" href="https://towardsdatascience.com/@isaacfaber?source=placement_card_footer_grid---------0-43" data-action="show-user-card" data-action-source="placement_card_footer_grid---------0-43" data-action-value="81d6b9acba62" data-action-type="hover" data-user-id="81d6b9acba62" data-collection-slug="towards-data-science" dir="auto">Isaac Faber</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><span class="readingTime u-textColorNormal" title="5 min read"></span></div></div></div></div><div class="u-flex0 u-flexCenter"><div class="buttonSet"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="f7335fb1f84f" data-is-label-padded="true" data-source="placement_card_footer_grid-----f7335fb1f84f----0-43----------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/f7335fb1f84f" data-action-source="placement_card_footer_grid-----f7335fb1f84f----0-43----------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-disablePointerEvents u-marginLeft4" data-action="show-recommends" data-action-value="f7335fb1f84f">1K</button></span></div></div><div class="u-height20 u-borderRightLighter u-inlineBlock u-relative u-marginRight10 u-marginLeft12"></div><div class="buttonSet"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/f7335fb1f84f" data-action-source="placement_card_footer_grid-----f7335fb1f84f----0-43----------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div><div class="col u-padding8 u-xs-size12of12 u-size4of12"><div class="uiScale uiScale-ui--small uiScale-caption--regular u-height280 u-sizeFullWidth u-backgroundWhite u-borderCardBorder u-boxShadow u-borderBox u-borderRadius4 js-trackedPost" data-post-id="373b744a4faa" data-source="placement_card_footer_grid---------1-43" data-tracking-context="placement" data-scroll="native"><a class="link link--noUnderline u-baseColor--link" href="https://medium.com/analytics-vidhya/25-fun-questions-for-a-machine-learning-interview-373b744a4faa?source=placement_card_footer_grid---------1-43" data-action-source="placement_card_footer_grid---------1-43"><div class="u-backgroundCover u-backgroundColorGrayLight u-height100 u-sizeFullWidth u-borderBottomLight u-borderRadiusTop4" style="background-image: url(&quot;https://cdn-images-1.medium.com/fit/c/400/120/1*pfmeGgGM5sxmLBQ5IQfQew.png&quot;); background-position: 50% 50% !important;"></div></a><div class="u-padding15 u-borderBox u-flexColumn u-height180"><a class="link link--noUnderline u-baseColor--link u-flex1" href="https://medium.com/analytics-vidhya/25-fun-questions-for-a-machine-learning-interview-373b744a4faa?source=placement_card_footer_grid---------1-43" data-action-source="placement_card_footer_grid---------1-43"><div class="uiScale uiScale-ui--regular uiScale-caption--small u-textColorNormal u-marginBottom7"><div class="u-floatRight u-textColorNormal"><span class="svgIcon svgIcon--star svgIcon--15px"><svg class="svgIcon-use" width="15" height="15" viewBox="0 0 15 15"><path d="M7.438 2.324c.034-.099.09-.099.123 0l1.2 3.53a.29.29 0 0 0 .26.19h3.884c.11 0 .127.049.038.111L9.8 8.327a.271.271 0 0 0-.099.291l1.2 3.53c.034.1-.011.131-.098.069l-3.142-2.18a.303.303 0 0 0-.32 0l-3.145 2.182c-.087.06-.132.03-.099-.068l1.2-3.53a.271.271 0 0 0-.098-.292L2.056 6.146c-.087-.06-.071-.112.038-.112h3.884a.29.29 0 0 0 .26-.19l1.2-3.52z"></path></svg></span></div><div class="u-noWrapWithEllipsis u-marginRight40">Also tagged Machine Learning</div></div><div class="ui-h3 ui-clamp2 u-textColorDarkest u-contentSansBold u-fontSize24 u-maxHeight2LineHeightTighter u-lineClamp2 u-textOverflowEllipsis u-letterSpacingTight u-paddingBottom2">25 fun questions for a machine learning interview</div></a><div class="u-paddingBottom10 u-flex0 u-flexCenter"><div class="u-flex1 u-minWidth0 u-marginRight10"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@tirthajyoti" data-action="show-user-card" data-action-value="cb9d97d4b61a" data-action-type="hover" data-user-id="cb9d97d4b61a" dir="auto"><div class="u-relative u-inlineBlock u-flex0"><img src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/1_dROuRoTytntKE6LLBKKzKA.jpeg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Tirthajyoti Sarkar"><div class="avatar-halo u-absolute u-textColorGreenNormal svgIcon" style="width: calc(100% + 10px); height: calc(100% + 10px); top:-5px; left:-5px"><svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M3.44615311,11.6601601 C6.57294867,5.47967718 12.9131553,1.5 19.9642857,1.5 C27.0154162,1.5 33.3556228,5.47967718 36.4824183,11.6601601 L37.3747245,11.2087295 C34.0793076,4.69494641 27.3961457,0.5 19.9642857,0.5 C12.5324257,0.5 5.84926381,4.69494641 2.55384689,11.2087295 L3.44615311,11.6601601 Z"></path><path d="M36.4824183,28.2564276 C33.3556228,34.4369105 27.0154162,38.4165876 19.9642857,38.4165876 C12.9131553,38.4165876 6.57294867,34.4369105 3.44615311,28.2564276 L2.55384689,28.7078582 C5.84926381,35.2216412 12.5324257,39.4165876 19.9642857,39.4165876 C27.3961457,39.4165876 34.0793076,35.2216412 37.3747245,28.7078582 L36.4824183,28.2564276 Z"></path></svg></div></div></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--darker" href="https://medium.com/@tirthajyoti?source=placement_card_footer_grid---------1-43" data-action="show-user-card" data-action-source="placement_card_footer_grid---------1-43" data-action-value="cb9d97d4b61a" data-action-type="hover" data-user-id="cb9d97d4b61a" dir="auto">Tirthajyoti Sarkar</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><span class="readingTime u-textColorNormal" title="6 min read"></span></div></div></div></div><div class="u-flex0 u-flexCenter"><div class="buttonSet"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="373b744a4faa" data-is-label-padded="true" data-source="placement_card_footer_grid-----373b744a4faa----1-43----------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/373b744a4faa" data-action-source="placement_card_footer_grid-----373b744a4faa----1-43----------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-disablePointerEvents u-marginLeft4" data-action="show-recommends" data-action-value="373b744a4faa">721</button></span></div></div><div class="u-height20 u-borderRightLighter u-inlineBlock u-relative u-marginRight10 u-marginLeft12"></div><div class="buttonSet"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/373b744a4faa" data-action-source="placement_card_footer_grid-----373b744a4faa----1-43----------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div><div class="col u-padding8 u-xs-size12of12 u-size4of12"><div class="uiScale uiScale-ui--small uiScale-caption--regular u-height280 u-sizeFullWidth u-backgroundWhite u-borderCardBorder u-boxShadow u-borderBox u-borderRadius4 js-trackedPost" data-post-id="b853b8621ac7" data-source="placement_card_footer_grid---------2-43" data-tracking-context="placement" data-scroll="native"><a class="link link--noUnderline u-baseColor--link" href="https://medium.mybridge.co/30-amazing-machine-learning-projects-for-the-past-year-v-2018-b853b8621ac7?source=placement_card_footer_grid---------2-43" data-action-source="placement_card_footer_grid---------2-43"><div class="u-backgroundCover u-backgroundColorGrayLight u-height100 u-sizeFullWidth u-borderBottomLight u-borderRadiusTop4" style="background-image: url(&quot;https://cdn-images-1.medium.com/fit/c/400/120/1*HJ59fa7cPLf625ItJZaqew.png&quot;); background-position: 50% 50% !important;"></div></a><div class="u-padding15 u-borderBox u-flexColumn u-height180"><a class="link link--noUnderline u-baseColor--link u-flex1" href="https://medium.mybridge.co/30-amazing-machine-learning-projects-for-the-past-year-v-2018-b853b8621ac7?source=placement_card_footer_grid---------2-43" data-action-source="placement_card_footer_grid---------2-43"><div class="uiScale uiScale-ui--regular uiScale-caption--small u-textColorNormal u-marginBottom7">Also tagged Data Science</div><div class="ui-h3 ui-clamp2 u-textColorDarkest u-contentSansBold u-fontSize24 u-maxHeight2LineHeightTighter u-lineClamp2 u-textOverflowEllipsis u-letterSpacingTight u-paddingBottom2">30 Amazing Machine Learning Projects for the Past Year (v.2018)</div></a><div class="u-paddingBottom10 u-flex0 u-flexCenter"><div class="u-flex1 u-minWidth0 u-marginRight10"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.mybridge.co/@Mybridge" data-action="show-user-card" data-action-value="68abb2e6c9bb" data-action-type="hover" data-user-id="68abb2e6c9bb" data-collection-slug="mybridge-for-professionals" dir="auto"><img src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/1_eUR4Sk2i-k4HRnaEPVUPWA.png" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Mybridge"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--darker" href="https://medium.mybridge.co/@Mybridge?source=placement_card_footer_grid---------2-43" data-action="show-user-card" data-action-source="placement_card_footer_grid---------2-43" data-action-value="68abb2e6c9bb" data-action-type="hover" data-user-id="68abb2e6c9bb" data-collection-slug="mybridge-for-professionals" dir="auto">Mybridge</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><span class="readingTime u-textColorNormal" title="6 min read"></span></div></div></div></div><div class="u-flex0 u-flexCenter"><div class="buttonSet"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="b853b8621ac7" data-is-label-padded="true" data-source="placement_card_footer_grid-----b853b8621ac7----2-43----------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/b853b8621ac7" data-action-source="placement_card_footer_grid-----b853b8621ac7----2-43----------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-disablePointerEvents u-marginLeft4" data-action="show-recommends" data-action-value="b853b8621ac7">14.6K</button></span></div></div><div class="u-height20 u-borderRightLighter u-inlineBlock u-relative u-marginRight10 u-marginLeft12"></div><div class="buttonSet"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/b853b8621ac7" data-action-source="placement_card_footer_grid-----b853b8621ac7----2-43----------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div></div></div></div></div><div class="u-padding0 u-clearfix u-backgroundGrayLightest u-print-hide supplementalPostContent js-responsesWrapper" data-action-scope="_actionscope_5"><div class="container u-maxWidth740"><div class="responsesStreamWrapper u-maxWidth640 js-responsesStreamWrapper"><div class="container responsesStream-title u-paddingTop15"><div class="row"><header class="heading"><div class="u-clearfix"><div class="heading-content u-floatLeft"><span class="heading-title heading-title--semibold">Responses</span></div></div></header></div></div><div class="responsesStream-editor cardChromeless u-marginBottom20 u-paddingLeft20 u-paddingRight20 js-responsesStreamEditor"><div class="u-paddingTop30 u-paddingBottom30 u-paddingLeft0 u-paddingRight0 u-borderBottomLightest js-responsesLoggedOutPrompt"><button class="button button--chromeless is-touchIconBlackPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--withIconAndLabel button--loggedOutPrompt" data-action="sign-up-prompt" data-redirect="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e#--respond" data-skip-onboarding="true" data-action-source="logged_out_response_prompt--------------------------respond_box"><span class="svgIcon svgIcon--response svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M21.27 20.058c1.89-1.826 2.754-4.17 2.754-6.674C24.024 8.21 19.67 4 14.1 4 8.53 4 4 8.21 4 13.384c0 5.175 4.53 9.385 10.1 9.385 1.007 0 2-.14 2.95-.41.285.25.592.49.918.7 1.306.87 2.716 1.31 4.19 1.31.276-.01.494-.14.6-.36a.625.625 0 0 0-.052-.65c-.61-.84-1.042-1.71-1.282-2.58a5.417 5.417 0 0 1-.154-.75zm-3.85 1.324l-.083-.28-.388.12a9.72 9.72 0 0 1-2.85.424c-4.96 0-8.99-3.706-8.99-8.262 0-4.556 4.03-8.263 8.99-8.263 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32c0 .07 0 .19.02.37.03.29.1.6.19.92.19.7.49 1.4.89 2.08-.93-.14-1.83-.49-2.67-1.06-.34-.22-.88-.48-1.16-.74z"></path></svg></span><span class="button-label  js-buttonLabel">Write a response…</span></button></div></div><div class="responsesStream js-responsesStream"><div class="streamItem streamItem--conversation js-streamItem" data-action-scope="_actionscope_6"><div class="streamItemConversation"><div class="u-marginLeft20"><div class="streamItemConversation-divider"></div><header class="heading heading--light heading--simple"><div class="u-clearfix"><div class="heading-content u-floatLeft"><span class="heading-title">Conversation with <a class="link link--accent u-accentColor--textNormal u-baseColor--link" href="https://medium.com/@rantav" data-action="show-user-card" data-action-value="586fab9c92fd" data-action-type="hover" data-user-id="586fab9c92fd" dir="auto">Ran Tavory</a>.</span></div></div></header></div><div class="streamItemConversation-inner cardChromeless"><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="24e1041b5259" data-source="responses---------0----------------" data-action-scope="_actionscope_7" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@michaelloewenstein" data-action="show-user-card" data-action-value="82091802e7ba" data-action-type="hover" data-user-id="82091802e7ba" dir="auto"><img src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/0_zhT0Ux1lUdx5Q8zr.jpg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Michael Loewenstein"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@michaelloewenstein?source=responses---------0----------------" data-action="show-user-card" data-action-source="responses---------0----------------" data-action-value="82091802e7ba" data-action-type="hover" data-user-id="82091802e7ba" dir="auto">Michael Loewenstein</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@michaelloewenstein/hey-ran-thanks-for-this-great-post-24e1041b5259?source=responses---------0----------------" data-action="open-post" data-action-value="https://medium.com/@michaelloewenstein/hey-ran-thanks-for-this-great-post-24e1041b5259?source=responses---------0----------------" data-action-source="preview-listing"><time datetime="2016-09-14T08:06:46.299Z">Sep 14, 2016</time></a><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="1 min read"></span></div></div></div></div></div><div class="js-inlineExpandBody"><a class="" href="https://medium.com/@michaelloewenstein/hey-ran-thanks-for-this-great-post-24e1041b5259?source=responses---------0----------------" data-action="expand-inline"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="2e33" id="2e33" class="graf graf--p graf--leading">Hey Ran, Thanks for this great post.</p><p name="4df1" id="4df1" class="graf graf--p graf-after--p graf--trailing">One question comes in mind as I have encountered a similar case of string matching; couldn’t this be easily solved using regex&nbsp;? trying to match ‘google’ from list A to any string in list b containing *google*, like ‘google inc’ or ‘google labs’ will give us the result we are looking for.</p></div></div></section></div></a></div><div class="postArticle-readMore"><button class="button button--smaller button--link u-baseColor--buttonNormal" data-action="expand-inline">Read more…</button></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="24e1041b5259" data-is-flush-left="true" data-source="listing-----24e1041b5259---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/24e1041b5259" data-action-source="listing-----24e1041b5259---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"></span></div></div><div class="buttonSet u-floatRight"><a class="button button--chromeless u-baseColor--buttonNormal" href="https://medium.com/@michaelloewenstein/hey-ran-thanks-for-this-great-post-24e1041b5259?source=responses---------0----------------#--responses" data-action-source="responses---------0----------------">1 response</a><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/24e1041b5259" data-action-source="listing-----24e1041b5259---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div><div class="streamItemConversationItem streamItemConversationItem--preview"><div class="postArticle js-postArticle js-trackedPost postArticle--short" data-post-id="f9c0f090bed5" data-source="responses---------0----------------" data-action-scope="_actionscope_8" data-scroll="native"><div class="u-clearfix u-marginBottom15 u-paddingTop5"><div class="postMetaInline u-floatLeft"><div class="u-flexCenter"><div class="postMetaInline-avatar u-flex0"><a class="link u-baseColor--link avatar" href="https://medium.com/@rantav" data-action="show-user-card" data-action-value="586fab9c92fd" data-action-type="hover" data-user-id="586fab9c92fd" dir="auto"><img src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/0_FtaU3aCLl7AOm9qe(1).jpg" class="avatar-image u-size36x36 u-xs-size32x32" alt="Go to the profile of Ran Tavory"></a></div><div class="postMetaInline postMetaInline-authorLockup ui-captionStrong u-flex1 u-noWrapWithEllipsis"><a class="ds-link ds-link--styleSubtle link link--darken link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@rantav?source=responses---------0----------------" data-action="show-user-card" data-action-source="responses---------0----------------" data-action-value="586fab9c92fd" data-action-type="hover" data-user-id="586fab9c92fd" dir="auto">Ran Tavory</a><div class="ui-caption u-fontSize12 u-baseColor--textNormal u-textColorNormal js-postMetaInlineSupplemental"><a class="link link--darken" href="https://medium.com/@rantav/hi-michael-im-not-sure-about-your-case-but-mine-could-not-be-easily-solved-using-regex-f9c0f090bed5?source=responses---------0----------------" data-action="open-post" data-action-value="https://medium.com/@rantav/hi-michael-im-not-sure-about-your-case-but-mine-could-not-be-easily-solved-using-regex-f9c0f090bed5?source=responses---------0----------------" data-action-source="preview-listing"><time datetime="2016-09-15T22:12:42.388Z">Sep 16, 2016</time></a><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="1 min read"></span></div></div></div></div></div><div class="js-inlineExpandBody"><a class="" href="https://medium.com/@rantav/hi-michael-im-not-sure-about-your-case-but-mine-could-not-be-easily-solved-using-regex-f9c0f090bed5?source=responses---------0----------------" data-action="expand-inline"><div class="postArticle-content js-postField"><section class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="ff54" id="ff54" class="graf graf--p graf--leading">Hi Michael, I’m not sure about your case, but mine could not be easily solved using regex.</p><p name="72da" id="72da" class="graf graf--p graf-after--p graf--trailing">First we need the TF/IDF story in order to observe which words are more meaningful and which are less meaningful (for example in “amazon labs” we have to understand that “amazon” is a relatively unique word and therefore meaningful and…</p></div></div></section></div></a></div><div class="postArticle-readMore"><button class="button button--smaller button--link u-baseColor--buttonNormal" data-action="expand-inline">Read more…</button></div><div class="u-clearfix u-paddingTop10"><div class="u-floatLeft"><div class="multirecommend js-actionMultirecommend u-flexCenter" data-post-id="f9c0f090bed5" data-is-flush-left="true" data-source="listing-----f9c0f090bed5---------------------clap_preview"><div class="u-relative u-foreground"><button class="button button--primary button--chromeless u-accentColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/f9c0f090bed5" data-action-source="listing-----f9c0f090bed5---------------------clap_preview" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.739 0l.761 2.966L13.261 0z"></path><path d="M14.815 3.776l1.84-2.551-1.43-.471z"></path><path d="M8.378 1.224l1.84 2.551L9.81.753z"></path><path d="M20.382 21.622c-1.04 1.04-2.115 1.507-3.166 1.608.168-.14.332-.29.492-.45 2.885-2.886 3.456-5.982 1.69-9.211l-1.101-1.937-.955-2.02c-.315-.676-.235-1.185.245-1.556a.836.836 0 0 1 .66-.16c.342.056.66.28.879.605l2.856 5.023c1.179 1.962 1.379 5.119-1.6 8.098m-13.29-.528l-5.02-5.02a1 1 0 0 1 .707-1.701c.255 0 .512.098.707.292l2.607 2.607a.442.442 0 0 0 .624-.624L4.11 14.04l-1.75-1.75a.998.998 0 1 1 1.41-1.413l4.154 4.156a.44.44 0 0 0 .624 0 .44.44 0 0 0 0-.624l-4.152-4.153-1.172-1.171a.998.998 0 0 1 0-1.41 1.018 1.018 0 0 1 1.41 0l1.172 1.17 4.153 4.152a.437.437 0 0 0 .624 0 .442.442 0 0 0 0-.624L6.43 8.222a.988.988 0 0 1-.291-.705.99.99 0 0 1 .29-.706 1 1 0 0 1 1.412 0l6.992 6.993a.443.443 0 0 0 .71-.501l-1.35-2.856c-.315-.676-.235-1.185.246-1.557a.85.85 0 0 1 .66-.16c.342.056.659.28.879.606L18.628 14c1.573 2.876 1.067 5.545-1.544 8.156-1.396 1.397-3.144 1.966-5.063 1.652-1.713-.286-3.463-1.248-4.928-2.714zM10.99 5.976l2.562 2.562c-.497.607-.563 1.414-.155 2.284l.265.562-4.257-4.257a.98.98 0 0 1-.117-.445c0-.267.104-.517.292-.706a1.023 1.023 0 0 1 1.41 0zm8.887 2.06c-.375-.557-.902-.916-1.486-1.011a1.738 1.738 0 0 0-1.342.332c-.376.29-.61.656-.712 1.065a2.1 2.1 0 0 0-1.095-.562 1.776 1.776 0 0 0-.992.128l-2.636-2.636a1.883 1.883 0 0 0-2.658 0 1.862 1.862 0 0 0-.478.847 1.886 1.886 0 0 0-2.671-.012 1.867 1.867 0 0 0-.503.909c-.754-.754-1.992-.754-2.703-.044a1.881 1.881 0 0 0 0 2.658c-.288.12-.605.288-.864.547a1.884 1.884 0 0 0 0 2.659l.624.622a1.879 1.879 0 0 0-.91 3.16l5.019 5.02c1.595 1.594 3.515 2.645 5.408 2.959a7.16 7.16 0 0 0 1.173.098c1.026 0 1.997-.24 2.892-.7.279.04.555.065.828.065 1.53 0 2.969-.628 4.236-1.894 3.338-3.338 3.083-6.928 1.738-9.166l-2.868-5.043z"></path></g></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--25px is-flushLeft"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M11.738 0l.762 2.966L13.262 0z"></path><path d="M16.634 1.224l-1.432-.47-.408 3.022z"></path><path d="M9.79.754l-1.431.47 1.84 2.552z"></path><path d="M22.472 13.307l-3.023-5.32c-.287-.426-.689-.705-1.123-.776a1.16 1.16 0 0 0-.911.221c-.297.231-.474.515-.535.84.017.022.036.04.053.063l2.843 5.001c1.95 3.564 1.328 6.973-1.843 10.144a8.46 8.46 0 0 1-.549.501c1.205-.156 2.328-.737 3.351-1.76 3.268-3.268 3.041-6.749 1.737-8.914"></path><path d="M12.58 9.887c-.156-.83.096-1.569.692-2.142L10.78 5.252c-.5-.504-1.378-.504-1.879 0-.178.18-.273.4-.329.63l4.008 4.005z"></path><path d="M15.812 9.04c-.218-.323-.539-.55-.88-.606a.814.814 0 0 0-.644.153c-.176.137-.713.553-.24 1.566l1.43 3.025a.539.539 0 1 1-.868.612L7.2 6.378a.986.986 0 1 0-1.395 1.395l4.401 4.403a.538.538 0 1 1-.762.762L5.046 8.54 3.802 7.295a.99.99 0 0 0-1.396 0 .981.981 0 0 0 0 1.394L3.647 9.93l4.402 4.403a.537.537 0 0 1 0 .761.535.535 0 0 1-.762 0L2.89 10.696a.992.992 0 0 0-1.399-.003.983.983 0 0 0 0 1.395l1.855 1.854 2.763 2.765a.538.538 0 0 1-.76.761l-2.765-2.764a.982.982 0 0 0-1.395 0 .989.989 0 0 0 0 1.395l5.32 5.32c3.371 3.372 6.64 4.977 10.49 1.126C19.74 19.8 20.271 17 18.62 13.982L15.812 9.04z"></path></g></svg></span></span></button></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-marginLeft5"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-disablePointerEvents" data-action="show-recommends" data-action-value="f9c0f090bed5">1</button></span></div></div><div class="buttonSet u-floatRight"><button class="button button--chromeless is-touchIconFadeInPulse u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/f9c0f090bed5" data-action-source="listing-----f9c0f090bed5---------------------bookmark_preview"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126a.508.508 0 0 0 .708-.03.5.5 0 0 0 .118-.285H19V6zm-6.838 9.97L7 19.636V6c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v13.637l-5.162-3.668a.49.49 0 0 0-.676 0z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--25px is-flushRight"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19 6c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v14.66h.012c.01.103.045.204.12.285a.5.5 0 0 0 .706.03L12.5 16.85l5.662 4.126c.205.183.52.17.708-.03a.5.5 0 0 0 .118-.285H19V6z"></path></svg></span></span></button></div></div></div></div></div></div></div></div><div class="container js-showOtherResponses"><div class="row"><button class="button button--primary button--withChrome u-accentColor--buttonNormal responsesStream-showOtherResponses cardChromeless u-sizeFullWidth u-marginVertical20 u-heightAuto" data-action="show-other-responses">Show all responses</button></div></div><div class="responsesStream js-responsesStreamOther"></div></div></div></div><div class="supplementalPostContent js-heroPromo"></div></footer></article></main><aside class="u-marginAuto u-maxWidth1000 js-postLeftSidebar"><div class="u-foreground u-top0 u-fixed u-sm-hide u-marginLeftNegative12 js-postShareWidget u-transition--fadeIn300" data-scroll="fixed" style="transform: translateY(150px);"><ul><li class="u-textAlignCenter u-marginVertical10"><div class="multirecommend js-actionMultirecommend u-flexColumn u-marginBottom10 u-width60" data-post-id="1be4b1b2871e" data-is-icon-29px="true" data-is-vertical="true" data-is-circle="true" data-has-recommend-list="true" data-source="post_share_widget-----1be4b1b2871e---------------------clap_sidebar"><div class="u-relative u-foreground"><button class="button button--large button--circle button--withChrome u-baseColor--buttonNormal button--withIcon button--withSvgIcon clapButton js-actionMultirecommendButton clapButton--largePill u-relative u-foreground u-xs-paddingLeft13 u-width60 u-height60 u-accentColor--textNormal u-accentColor--buttonNormal" data-action="sign-up-prompt" data-sign-in-action="multivote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/1be4b1b2871e" data-action-source="post_share_widget-----1be4b1b2871e---------------------clap_sidebar" aria-label="Clap"><span class="button-defaultState"><span class="svgIcon svgIcon--clap svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33" viewBox="0 0 33 33"><path d="M28.86 17.342l-3.64-6.402c-.292-.433-.712-.729-1.163-.8a1.124 1.124 0 0 0-.889.213c-.63.488-.742 1.181-.33 2.061l1.222 2.587 1.4 2.46c2.234 4.085 1.511 8.007-2.145 11.663-.26.26-.526.49-.797.707 1.42-.084 2.881-.683 4.292-2.094 3.822-3.823 3.565-7.876 2.05-10.395zm-6.252 11.075c3.352-3.35 3.998-6.775 1.978-10.469l-3.378-5.945c-.292-.432-.712-.728-1.163-.8a1.122 1.122 0 0 0-.89.213c-.63.49-.742 1.182-.33 2.061l1.72 3.638a.502.502 0 0 1-.806.568l-8.91-8.91a1.335 1.335 0 0 0-1.887 1.886l5.292 5.292a.5.5 0 0 1-.707.707l-5.292-5.292-1.492-1.492c-.503-.503-1.382-.505-1.887 0a1.337 1.337 0 0 0 0 1.886l1.493 1.492 5.292 5.292a.499.499 0 0 1-.353.854.5.5 0 0 1-.354-.147L5.642 13.96a1.338 1.338 0 0 0-1.887 0 1.338 1.338 0 0 0 0 1.887l2.23 2.228 3.322 3.324a.499.499 0 0 1-.353.853.502.502 0 0 1-.354-.146l-3.323-3.324a1.333 1.333 0 0 0-1.886 0 1.325 1.325 0 0 0-.39.943c0 .356.138.691.39.943l6.396 6.397c3.528 3.53 8.86 5.313 12.821 1.353zM12.73 9.26l5.68 5.68-.49-1.037c-.518-1.107-.426-2.13.224-2.89l-3.303-3.304a1.337 1.337 0 0 0-1.886 0 1.326 1.326 0 0 0-.39.944c0 .217.067.42.165.607zm14.787 19.184c-1.599 1.6-3.417 2.392-5.353 2.392-.349 0-.7-.03-1.058-.082a7.922 7.922 0 0 1-3.667.887c-3.049 0-6.115-1.626-8.359-3.87l-6.396-6.397A2.315 2.315 0 0 1 2 19.724a2.327 2.327 0 0 1 1.923-2.296l-.875-.875a2.339 2.339 0 0 1 0-3.3 2.33 2.33 0 0 1 1.24-.647l-.139-.139c-.91-.91-.91-2.39 0-3.3.884-.884 2.421-.882 3.301 0l.138.14a2.335 2.335 0 0 1 3.948-1.24l.093.092c.091-.423.291-.828.62-1.157a2.336 2.336 0 0 1 3.3 0l3.384 3.386a2.167 2.167 0 0 1 1.271-.173c.534.086 1.03.354 1.441.765.11-.549.415-1.034.911-1.418a2.12 2.12 0 0 1 1.661-.41c.727.117 1.385.565 1.853 1.262l3.652 6.423c1.704 2.832 2.025 7.377-2.205 11.607zM13.217.484l-1.917.882 2.37 2.837-.454-3.719zm8.487.877l-1.928-.86-.44 3.697 2.368-2.837zM16.5 3.293L15.478-.005h2.044L16.5 3.293z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--clapFilled svgIcon--33px u-relative u-topNegative2 u-xs-top0"><svg class="svgIcon-use" width="33" height="33" viewBox="0 0 33 33"><g fill-rule="evenodd"><path d="M29.58 17.1l-3.854-6.78c-.365-.543-.876-.899-1.431-.989a1.491 1.491 0 0 0-1.16.281c-.42.327-.65.736-.7 1.207v.001l3.623 6.367c2.46 4.498 1.67 8.802-2.333 12.807-.265.265-.536.505-.81.728 1.973-.222 3.474-1.286 4.45-2.263 4.166-4.165 3.875-8.6 2.215-11.36zm-4.831.82l-3.581-6.3c-.296-.439-.725-.742-1.183-.815a1.105 1.105 0 0 0-.89.213c-.647.502-.755 1.188-.33 2.098l1.825 3.858a.601.601 0 0 1-.197.747.596.596 0 0 1-.77-.067L10.178 8.21c-.508-.506-1.393-.506-1.901 0a1.335 1.335 0 0 0-.393.95c0 .36.139.698.393.95v.001l5.61 5.61a.599.599 0 1 1-.848.847l-5.606-5.606c-.001 0-.002 0-.003-.002L5.848 9.375a1.349 1.349 0 0 0-1.902 0 1.348 1.348 0 0 0 0 1.901l1.582 1.582 5.61 5.61a.6.6 0 0 1-.848.848l-5.61-5.61c-.51-.508-1.393-.508-1.9 0a1.332 1.332 0 0 0-.394.95c0 .36.139.697.393.952l2.363 2.362c.002.001.002.002.002.003l3.52 3.52a.6.6 0 0 1-.848.847l-3.522-3.523h-.001a1.336 1.336 0 0 0-.95-.393 1.345 1.345 0 0 0-.949 2.295l6.779 6.78c3.715 3.713 9.327 5.598 13.49 1.434 3.527-3.528 4.21-7.13 2.086-11.015zM11.817 7.727c.06-.328.213-.64.466-.893.64-.64 1.755-.64 2.396 0l3.232 3.232c-.82.783-1.09 1.833-.764 2.992l-5.33-5.33z"></path><path d="M13.285.48l-1.916.881 2.37 2.837z"></path><path d="M21.719 1.361L19.79.501l-.44 3.697z"></path><path d="M16.502 3.298L15.481 0h2.043z"></path></g></svg></span></span></button><div class="clapUndo u-width60 u-round u-height32 u-absolute u-borderBox u-paddingRight5 u-transition--transform200Spring u-background--brandSageLighter js-clapUndo" style="top: 14px; padding: 2px;"><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon u-floatRight" data-action="multivote-undo" data-action-value="1be4b1b2871e"><span class="svgIcon svgIcon--removeThin svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M20.13 8.11l-5.61 5.61-5.609-5.61-.801.801 5.61 5.61-5.61 5.61.801.8 5.61-5.609 5.61 5.61.8-.801-5.609-5.61 5.61-5.61" fill-rule="evenodd"></path></svg></span></button></div></div><span class="u-textAlignCenter u-relative u-background js-actionMultirecommendCount u-flexOrderNegative1 u-height20 u-marginBottom7"><button class="button button--chromeless u-baseColor--buttonNormal js-multirecommendCountButton u-block u-marginAuto" data-action="show-recommends" data-action-value="1be4b1b2871e">97</button></span></div></li><li class="u-textAlignCenter u-marginVertical10"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon" title="Share on Twitter" aria-label="Share on Twitter" data-action="share-on-twitter" data-action-source="post_share_widget"><span class="svgIcon svgIcon--twitter svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"></path></svg></span></button></li><li class="u-textAlignCenter u-marginVertical10"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon" title="Share on Facebook" aria-label="Share on Facebook" data-action="share-on-facebook" data-action-source="post_share_widget"><span class="svgIcon svgIcon--facebook svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"></path></svg></span></button></li><li class="u-textAlignCenter u-marginVertical10"><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton" title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-up-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/1be4b1b2871e" data-action-source="post_share_widget-----1be4b1b2871e---------------------bookmark_sidebar"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"></path></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29"><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"></path></svg></span></span></button></li></ul></div></aside><div class="u-fixed u-bottom0 u-sizeFullWidth u-backgroundWhite u-boxShadowTop u-borderBox u-paddingTop10 u-paddingBottom10 u-zIndexMetabar u-xs-paddingLeft10 u-xs-paddingRight10 js-stickyFooter"><div class="u-maxWidth700 u-marginAuto u-flexCenter"><div class="u-fontSize16 u-flex1 u-flexCenter"><div class="u-flex0 u-inlineBlock u-paddingRight20 u-xs-paddingRight10"><a class="link u-baseColor--link avatar u-inline" href="https://medium.com/@rantav" data-action="show-user-card" data-action-value="586fab9c92fd" data-action-type="hover" data-user-id="586fab9c92fd" dir="auto"><img src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/0_FtaU3aCLl7AOm9qe(2).jpg" class="avatar-image avatar-image--smaller" alt="Go to the profile of Ran Tavory"></a></div><div class="u-flex1 u-inlineBlock"><div class="u-xs-hide">Never miss a story from<strong> Ran Tavory</strong>, when you sign up for Medium. <a class="link u-baseColor--link link--accent u-accentColor--textNormal u-accentColor--textDarken" href="https://medium.com/@Medium/personalize-your-medium-experience-with-users-publications-tags-26a41ab1ee0c#.hx4zuv3mg" data-action-source="sticky_footer">Learn more</a></div><div class="u-xs-show">Never miss a story from<strong> Ran Tavory</strong></div></div></div><div class="u-marginLeft50 u-xs-marginAuto"><span class="followState js-followState" data-user-id="586fab9c92fd"><button class="button u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-uiTextSemibold u-textUppercase u-fontSize12" data-action="sign-up-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-redirect="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e" data-action-source="sticky_footer"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary is-active u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton u-uiTextSemibold u-textUppercase u-fontSize12" data-action="sign-up-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/586fab9c92fd" data-action-source="sticky_footer-586fab9c92fd-------------------------follow_metabar"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Get updates</span></button></span></div></div></div><div class="highlightMenu" data-action-scope="_actionscope_3"><div class="highlightMenu-inner"><div class="buttonSet"><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--highlightMenu u-accentColor--highlightStrong js-highlightMenuQuoteButton" data-action="sign-up-prompt" data-sign-in-action="quote" data-requires-token="true" data-redirect="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e" data-skip-onboarding="true" data-redirect-type="quote" data-action-source="quote_menu--------------------------highlight_text"><span class="svgIcon svgIcon--highlighter svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M13.7 15.964l5.204-9.387-4.726-2.62-5.204 9.387 4.726 2.62zm-.493.885l-1.313 2.37-1.252.54-.702 1.263-3.796-.865 1.228-2.213-.202-1.35 1.314-2.37 4.722 2.616z" fill-rule="evenodd"></path></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--highlightMenu" data-action="sign-up-prompt" data-sign-in-action="quote-respond" data-redirect="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e" data-skip-onboarding="true" data-action-source="quote_menu--------------------------respond_text"><span class="svgIcon svgIcon--responseFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M19.074 21.117c-1.244 0-2.432-.37-3.532-1.096a7.792 7.792 0 0 1-.703-.52c-.77.21-1.57.32-2.38.32-4.67 0-8.46-3.5-8.46-7.8C4 7.7 7.79 4.2 12.46 4.2c4.662 0 8.457 3.5 8.457 7.803 0 2.058-.85 3.984-2.403 5.448.023.17.06.35.118.55.192.69.537 1.38 1.026 2.04.15.21.172.48.058.7a.686.686 0 0 1-.613.38h-.03z" fill-rule="evenodd"></path></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--highlightMenu" data-action="twitter" data-action-source="quote_menu" data-skip-onboarding="true"><span class="svgIcon svgIcon--twitterFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><path d="M21.725 5.338c-.744.47-1.605.804-2.513 1.006a3.978 3.978 0 0 0-2.942-1.293c-2.22 0-4.02 1.81-4.02 4.02 0 .32.034.63.07.94-3.31-.18-6.27-1.78-8.255-4.23a4.544 4.544 0 0 0-.574 2.01c.04 1.43.74 2.66 1.8 3.38-.63-.01-1.25-.19-1.79-.5v.08c0 1.93 1.38 3.56 3.23 3.95-.34.07-.7.12-1.07.14-.25-.02-.5-.04-.72-.07.49 1.58 1.97 2.74 3.74 2.8a8.49 8.49 0 0 1-5.02 1.72c-.3-.03-.62-.04-.93-.07A11.447 11.447 0 0 0 8.88 21c7.386 0 11.43-6.13 11.414-11.414.015-.21.01-.38 0-.578a7.604 7.604 0 0 0 2.01-2.08 7.27 7.27 0 0 1-2.297.645 3.856 3.856 0 0 0 1.72-2.23"></path></svg></span></button><div class="buttonSet-separator"></div><button class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon button--highlightMenu" data-action="sign-up-prompt" data-sign-in-action="highlight" data-redirect="https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e" data-skip-onboarding="true" data-action-source="quote_menu--------------------------privatenote_text"><span class="svgIcon svgIcon--privatenoteFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25"><g fill-rule="evenodd"><path d="M17.662 4.552H7.346A4.36 4.36 0 0 0 3 8.898v5.685c0 2.168 1.614 3.962 3.697 4.28v2.77c0 .303.35.476.59.29l3.904-2.994h6.48c2.39 0 4.35-1.96 4.35-4.35V8.9c0-2.39-1.95-4.346-4.34-4.346zM16 14.31a.99.99 0 0 1-1.003.99h-4.994C9.45 15.3 9 14.85 9 14.31v-3.02a.99.99 0 0 1 1-.99v-.782a2.5 2.5 0 0 1 2.5-2.51c1.38 0 2.5 1.13 2.5 2.51v.782c.552.002 1 .452 1 .99v3.02z"></path><path d="M14 9.81c0-.832-.674-1.68-1.5-1.68-.833 0-1.5.84-1.5 1.68v.49h3v-.49z"></path></g></svg></span></button></div></div><div class="highlightMenu-arrowClip"><span class="highlightMenu-arrow"></span></div></div></div></div></div><div class="loadingBar"></div><script>// <![CDATA[
window["obvInit"] = function (opt_embedded) {window["obvInit"]["embedded"] = opt_embedded; window["obvInit"]["ready"] = true;}
// ]]></script><script>// <![CDATA[
var GLOBALS = {"audioUrl":"https://d1fcbxp97j4nb2.cloudfront.net","baseUrl":"https://medium.com","buildLabel":"34742-2bac98a","currentUser":{"userId":"lo_7ee23abbbab9","isVerified":false,"subscriberEmail":"","hasPastMemberships":false,"isEnrolledInHightower":false,"isEligibleForHightower":false,"hightowerLastLockedAt":0,"isWriterProgramEnrolled":false,"isWriterProgramInvited":false,"isWriterProgramOptedOut":false},"currentUserHasUnverifiedEmail":false,"isAuthenticated":false,"isCurrentUserVerified":false,"language":"en-us","miroUrl":"https://cdn-images-1.medium.com","moduleUrls":{"base":"https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.t75scpQGoB32yGtcW06FAQ.js","common-async":"https://cdn-static-1.medium.com/_/fp/gen-js/main-common-async.bundle.nJD9-yjP0__r2XhkwIzYwQ.js","hightower":"https://cdn-static-1.medium.com/_/fp/gen-js/main-hightower.bundle.lyMtEgvr6vx3RmPx-TcNPg.js","home-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-home-screens.bundle.rETwCz2rT4MOOaxsV6NeMg.js","misc-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-misc-screens.bundle.NgZ2kCyRYN1wSA9SFxSx7w.js","notes":"https://cdn-static-1.medium.com/_/fp/gen-js/main-notes.bundle.YL0ZDiM8Uv0f_wuvzZFRDQ.js","payments":"https://cdn-static-1.medium.com/_/fp/gen-js/main-payments.bundle.U9gFJA1f4kskkNz5EnQnug.js","posters":"https://cdn-static-1.medium.com/_/fp/gen-js/main-posters.bundle.hf6p7AoMRwwyCNFV-W_MIw.js","power-readers":"https://cdn-static-1.medium.com/_/fp/gen-js/main-power-readers.bundle.DWOaMAlaWz-NjqCTmZ6Kgw.js","pubs":"https://cdn-static-1.medium.com/_/fp/gen-js/main-pubs.bundle.4IFFvlnVIaZlVtY-TWyK5g.js","stats":"https://cdn-static-1.medium.com/_/fp/gen-js/main-stats.bundle.buLWUhAsdID8Fc4h9KFHCA.js"},"previewConfig":{"weightThreshold":1,"weightImageParagraph":0.51,"weightIframeParagraph":0.8,"weightTextParagraph":0.08,"weightEmptyParagraph":0,"weightP":0.003,"weightH":0.005,"weightBq":0.003,"minPTextLength":60,"truncateBoundaryChars":20,"detectTitle":true,"detectTitleLevThreshold":0.15},"productName":"Medium","supportsEdit":true,"termsUrl":"//medium.com/policy/9db0094a1e0f","textshotHost":"textshot.medium.com","transactionId":"1535517163168:90c019be2393","useragent":{"browser":"chrome","family":"chrome","os":"windows","version":69,"supportsDesktopEdit":true,"supportsInteract":true,"supportsView":true,"isMobile":false,"isTablet":false,"isNative":false,"supportsFileAPI":true,"isTier1":true,"clientVersion":"","unknownParagraphsBad":false,"clientChannel":"","supportsRealScrollEvents":true,"supportsVhUnits":true,"ruinsViewportSections":false,"supportsHtml5Video":true,"supportsMagicUnderlines":true,"isWebView":false,"isFacebookWebView":false,"supportsProgressiveMedia":true,"supportsPromotedPosts":true,"isBot":false,"isNativeIphone":false,"supportsCssVariables":true,"supportsVideoSections":true,"emojiSupportLevel":1,"isSearchBot":false,"isSyndicationBot":false,"supportsScrollableMetabar":true},"variants":{"allow_access":true,"allow_signup":true,"allow_test_auth":"disallow","signin_services":"twitter,facebook,google,email,google-fastidv","signup_services":"twitter,facebook,google,email,google-fastidv","android_rating_prompt_recommend_threshold":5,"google_sign_in_android":true,"reengagement_notification_duration":3,"browsable_stream_config_bucket":"curated-topics","enable_dedicated_series_tab_api_ios":true,"enable_post_import":true,"available_monthly_plan":"60e220181034","available_annual_plan":"2c754bcc2995","marketing_promo_experiment_b":"bucket_two","disable_ios_resume_reading_toast":true,"is_not_medium_subscriber":true,"glyph_font_set":"m2","enable_branding":true,"enable_branding_fonts":true,"enable_multirecommends":true,"enable_post_monger_v2":true,"enable_post_monger_v3":true,"enable_fastrak_beta":true,"enable_fastrak_beta_opt_out_toggle":true,"enable_user_post_metering":true,"max_premium_content_per_user_under_metering":3,"enable_automated_mission_control_triggers":true,"enable_user_profile_featured_moc":true,"enable_strong_graph_chp_reorder":true,"enable_top_stories_for_you":true,"enable_ios_member_post_labeling":true,"enable_lite_profile":true,"enable_li_search_collection":true,"enable_homepage_remodel":true,"enable_signin_wall_custom_domain":true,"app_download_email_template":"control","enable_curation_post_locking":true,"ios_hide_avatars_on_home":true,"android_disable_author_avatars":true,"enable_truncated_rss_for_tags_and_topics":true,"enable_ios_related_reads_api_change":true,"enable_ios_related_reads_ui_large":true,"enable_ios_responses_collapsed":true,"enable_parsely":true,"enable_synchronous_parsely":true,"enable_curation_master_feed":true,"enable_distributable_post_post_similarity_table":true,"enable_post_stats_page":true,"enable_ios_post_stats":true,"enable_prepublish_flow_2":true,"enable_prepublish_flow_2_featured_image_selector":true,"enable_prepublish_flow_2_milestone_2":true,"enable_prepublish_flow_2_republish":true,"enable_lite_topics":true,"enable_lite_stories":true,"enable_lite_billing_history":true,"accelerate_membership_headline_test":"feeds-headline","enable_deviant_shadow_reads":true,"enable_new_meter_email_design":true,"new_meter_email_experiment":true,"enable_profile_page_updates":true,"enable_meter_banner_copy_test":true,"annual_renewal_reminder_email_variant":"fun","enable_annual_renewal_reminder_email":true,"enable_sift_integration":true,"enable_quality_assurance_queue":true,"enable_boost_moc_highlights":true,"enable_writer_controls":true},"xsrfToken":"","iosAppId":"828256236","supportEmail":"yourfriends@medium.com","fp":{"/icons/monogram-mask.svg":"https://cdn-static-1.medium.com/_/fp/icons/monogram-mask.KPLCSFEZviQN0jQ7veN2RQ.svg","/icons/favicon-dev-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-dev-editor.YKKRxBO8EMvIqhyCwIiJeQ.ico","/icons/favicon-hatch-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-hatch-editor.BuEyHIqlyh2s_XEk4Rl32Q.ico","/icons/favicon-medium-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrl":"https://medium.com","imageUploadSizeMb":25,"isAuthDomainRequest":true,"algoliaApiEndpoint":"https://MQ57UUUQZ2-dsn.algolia.net","algoliaAppId":"MQ57UUUQZ2","algoliaSearchOnlyApiKey":"394474ced050e3911ae2249ecc774921","iosAppStoreUrl":"https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8","iosAppLinkBaseUrl":"medium:","algoliaIndexPrefix":"medium_","androidPlayStoreUrl":"https://play.google.com/store/apps/details?id=com.medium.reader","googleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","androidPackage":"com.medium.reader","androidPlayStoreMarketScheme":"market://details?id=com.medium.reader","googleAuthUri":"https://accounts.google.com/o/oauth2/auth","androidScheme":"medium","layoutData":{"useDynamicScripts":false,"googleAnalyticsTrackingCode":"UA-24232453-2","jsShivUrl":"https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js","useDynamicCss":false,"faviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium.3Y6xpZ-0FSdWDnPM3hSBIA.ico","faviconImageId":"1*8I-HPL0bfoIzGied-dzOvA.png","fontSets":[{"id":8,"url":"https://glyph.medium.com/css/e/sr/latin/e/ssr/latin/e/ssb/latin/m2.css"},{"id":11,"url":"https://glyph.medium.com/css/m2.css"},{"id":9,"url":"https://glyph.medium.com/css/mkt.css"},{"id":10,"url":"https://glyph.medium.com/css/elv8.css"}],"editorFaviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-rebrand-medium-editor.3Y6xpZ-0FSdWDnPM3hSBIA.ico","glyphUrl":"https://glyph.medium.com"},"authBaseUrlRev":"moc.muidem//:sptth","isDnt":false,"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","archiveUploadSizeMb":100,"paymentData":{"currencies":{"1":{"label":"US Dollar","external":"usd"}},"countries":{"1":{"label":"United States of America","external":"US"}},"accountTypes":{"1":{"label":"Individual","external":"individual"},"2":{"label":"Company","external":"company"}}},"previewConfig2":{"weightThreshold":1,"weightImageParagraph":0.05,"raiseImage":true,"enforceHeaderHierarchy":true,"isImageInsetRight":true},"isAmp":false,"iosScheme":"medium","isSwBoot":false,"lightstep":{"accessToken":"ce5be895bef60919541332990ac9fef2","carrier":"{\"ot-tracer-spanid\":\"6bad64d057085a7e\",\"ot-tracer-traceid\":\"5197dbb55248bd42\",\"ot-tracer-sampled\":\"true\"}","host":"collector-medium.lightstep.com"},"facebook":{"key":"542599432471018","namespace":"medium-com","scope":{"default":["public_profile","email"],"connect":["public_profile","email"],"login":["public_profile","email"],"share":["public_profile","email"]}},"editorsPicksTopicId":"3985d2a191c5","popularOnMediumTopicId":"9d34e48ecf94","memberContentTopicId":"13d7efd82fb2","audioContentTopicId":"3792abbd134","brandedSequenceId":"7d337ddf1941","isDoNotAuth":false,"goldfinchUrl":"https://goldfinch.medium.com","buggle":{"url":"https://buggle.medium.com","videoUrl":"https://cdn-videos-1.medium.com","audioUrl":"https://cdn-audio-1.medium.com"},"referrerType":2,"isMeteredOut":false,"meterConfig":{"maxUnlockCount":3,"windowLength":"MONTHLY"},"partnerProgramEmail":"partnerprogram@medium.com","userResearchPrompts":[{"promptId":"lo_post_page_4","type":0,"url":"www.calendly.com"},{"promptId":"lo_home_page","type":1,"url":"www.calendly.com"},{"promptId":"lo_profile_page","type":2,"url":"www.calendly.com"}],"recaptchaKey":"6LdAokEUAAAAAC7seICd4vtC8chDb3jIXDQulyUJ","paypalClientMode":"production","signinWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"countryCode":"IN","bypassMeter":false,"branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm"}
// ]]></script><script charset="UTF-8" src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/main-base.bundle.t75scpQGoB32yGtcW06FAQ.js.download" async=""></script><script>// <![CDATA[
window["obvInit"]({"value":{"id":"1be4b1b2871e","versionId":"35e9c82d6681","creatorId":"586fab9c92fd","creator":{"userId":"586fab9c92fd","name":"Ran Tavory","username":"rantav","createdAt":1369486700069,"lastPostCreatedAt":1510166886120,"imageId":"0*FtaU3aCLl7AOm9qe.jpg","backgroundImageId":"","bio":"Founder yodas.com","twitterScreenName":"rantav","socialStats":{"userId":"586fab9c92fd","usersFollowedCount":217,"usersFollowedByCount":501,"type":"SocialStats"},"social":{"userId":"lo_7ee23abbbab9","targetUserId":"586fab9c92fd","type":"Social"},"facebookAccountId":"10152390218577174","allowNotes":1,"isNsfw":false,"isWriterProgramInvited":false,"isPartnerProgramEnrolled":false,"isWriterProgramEnrolled":false,"isWriterProgramOptedOut":false,"type":"User"},"homeCollectionId":"","title":"Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…","detectedLanguage":"en","latestVersion":"35e9c82d6681","latestPublishedVersion":"35e9c82d6681","hasUnpublishedEdits":false,"latestRev":2552,"createdAt":1469656111891,"updatedAt":1528981809120,"acceptedAt":0,"firstPublishedAt":1470163354903,"latestPublishedAt":1472501913379,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"Spark and pyspark have wonderful support for reliable distribution and parallelization of programs as well as support for many basic…","bodyModel":{"paragraphs":[{"name":"2954","type":3,"text":"Large scale matrix multiplication with pyspark (or — how to match two large datasets of company names)","markups":[]},{"name":"a2e3","type":1,"text":"Spark and pyspark have wonderful support for reliable distribution and parallelization of programs as well as support for many basic algebraic operations and machine learning algorithms.","markups":[]},{"name":"6e1d","type":1,"text":"In this post we describe the motivation and means of performing name-by-name matching of two large datasets of company names using Spark.","markups":[]},{"name":"ddc7","type":3,"text":"Motivation first","markups":[]},{"name":"ed57","type":1,"text":"Our goal is to match two large sets of company names. We’re looking at two long lists of company names, list A and list B and we aim to match companies from A to companies from B.","markups":[]},{"name":"b5ec","type":1,"text":"Typically we would have something like this:","markups":[]},{"name":"e490","type":8,"text":"List A       | List B\n---------------------\nGOOGLE INC.  | Google\nMEDIUM.COM   | Medium Inc\nAmazon labs  | Amazon\nGoogle, inc  |\nYahoo        |\n             | Microsoft","markups":[]},{"name":"ee9f","type":1,"text":"In this example our goal is to match both GOOGLE INC. and Google, inc (from list A) to Google (from list B); and to match MEDIUM.COM to Medium Inc; and Amazon labs to Amazon, etc…","markups":[]},{"name":"df51","type":1,"text":"Looking at this simple example, a few things stand out:","markups":[]},{"name":"2226","type":9,"text":"It’s possible for more than one company from A to match a single company from B; it’s a many-to-one relationship.","markups":[]},{"name":"a6d2","type":9,"text":"Company names are in most cases easy for humans to match (e.g. Amazon labs to Amazon) but are not as easy for computers to match (how does the computer know that “labs” in this case is insignificant and that “Amazon” is just a short for “Amazon labs”?)","markups":[]},{"name":"9de1","type":9,"text":"Not all companies from A have matches in B, and not all companies from B are matched from A. In our example Yahoo from list A is not matched to any other company on B and Microsoft from B is not matched to any company on A either.","markups":[]},{"name":"3e2b","type":9,"text":"Any element from list A should have at most one match from the B. The opposite isn’t true as noted, many companies from A could be matched into a single company on B.","markups":[]},{"name":"627c","type":3,"text":"First attempt — trivial match","markups":[]},{"name":"984f","type":1,"text":"OK, At first we thought we’d try the most simple and trivial solution, to see how well it works, if not for anything else, at the very least in order to establish a baseline for future attempts. The most simple thing to do is just case-insensitive string equation test. Simply match the strings from A to the strings from B.","markups":[]},{"name":"c72c","type":13,"text":"Precision and Recall","markups":[]},{"name":"6f4e","type":1,"text":"There are two relevant measures to look at: Precision and Recall. Precision is “how many mistakes did we (not) make”, or in other words — given all matches, how many of them were indeed correct matches — Precise matches. So precision is about false positives.","markups":[{"type":1,"start":243,"end":258},{"type":2,"start":44,"end":53},{"type":2,"start":58,"end":64},{"type":2,"start":204,"end":211}]},{"name":"aa99","type":1,"text":"Recall on the other hand is “how many matches should have been found, but were missed”. So recall is about the false negatives.","markups":[{"type":1,"start":111,"end":126},{"type":2,"start":0,"end":6}]},{"name":"70d0","type":1,"text":"The first trivial attempt was, as expected, high on precision but low on recall. If we look at out short list of example companies it would match zero elements from A to B. That’s very poor recall, but 100% precision ;-). Of course in real-world scenario it would match a bit more than zero but it’s easy to see that due to many small possible variations in company names recall would remain low.","markups":[{"type":1,"start":146,"end":150}]},{"name":"e652","type":1,"text":"A simple improvement to that would be the removal of stop-words.","markups":[{"type":2,"start":42,"end":63}]},{"name":"f460","type":13,"text":"Stop Words","markups":[]},{"name":"34b5","type":1,"text":"What are stop-words? Stop-words are words that get removed before processions various NLP algorithms because they don’t add information, usually they just add noise. In plain english stop-words are usually the “of”, “for” “if” etc of the language, these are very common words that get used a lot, but for many NLP and IR algorithms then don’t add information. They make for correct syntactical sentences and in many cases they affect the semantics, however at the level of many NLP processors, which don’t look at actual syntax, they are meaningless.","markups":[{"type":3,"start":21,"end":31,"href":"https://en.wikipedia.org/wiki/Stop_words","title":"","rel":"","anchorType":0},{"type":2,"start":9,"end":19}]},{"name":"0947","type":1,"text":"In our case the stop-words are not the “if”, “of” or “for” which are typical in English, but they are the “inc” and “llc” from the company extension. So our simple improvement is to just remove all these company extensions and try the simple string equation once again.","markups":[]},{"name":"2895","type":1,"text":"This indeed helped and as you can see in our example, this helped match “Google inc.” to “Google” and with simple punctuation removal and correct tokenization, we also match “Google, inc” to “Google”. But that still doesn’t match “Amazon labs” to “Amazon” b/c “labs” is not a stop-word in the sense that it isn’t not a common company extension. As it turns out, “Amazon labs” isn’t just a random example, many company names have these variations in their names that are manifested in one dataset but are not manifested in other datasets. Conclusion: we have to find a way to “look beyond that”, ignore the “labs” in “Amazon labs”.","markups":[{"type":3,"start":319,"end":343,"href":"http://www.corporateinformation.com/Company-Extensions-Security-Identifiers.aspx","title":"","rel":"","anchorType":0},{"type":1,"start":181,"end":182}]},{"name":"ca93","type":1,"text":"Let us meet science.","markups":[]},{"name":"4cdc","type":3,"text":"The Science","markups":[]},{"name":"b16c","type":1,"text":"What we’re looking at here is the problem of matching N documents from list A to M documents in list B, in many-to-one relationship. But our matching algorithm needs to be “smart”, in the sense that it needs to be able to distinguish between “important words” and “non important words”. We need to find a way to tell the computer that “labs” in “amazon labs” is insignificant but “amazon” is indeed significant. We would also trivially tokenize the names into smaller tokens by splitting by spaces, punctuation etc, so that “medium.com” would get broken up into “medium” and “com”.","markups":[]},{"name":"26ba","type":1,"text":"Science to the rescue!","markups":[]},{"name":"fe04","type":13,"text":"TF-IDF","markups":[]},{"name":"e914","type":1,"text":"To that end we use a common scheme in information retrieval theory called TF-IDF. TF-IDF stands for Term Frequency — Inverted Document Frequency. Term Frequency simply means “how many times this word appears in this document” (our documents are just company names, so they are very short “documents”). So in the case of “amazon labs” we have only two words in the document “amazon” and “labs” and their frequency is simply 1 and 1. (If by the way the name of the company just happened to be “amazon labs amazon” then the count would have been 2 for “amazon” and 1 for “labs”.) That’s what TF is all about, quite simple: Count the frequency of terms in the document.","markups":[{"type":3,"start":74,"end":80,"href":"https://en.wikipedia.org/wiki/Tf%E2%80%93idf","title":"","rel":"","anchorType":0}]},{"name":"fdb2","type":1,"text":"Inverted Document Frequency is the real deal. The inverted document frequency looks at all “documents” (aka corpus, all the company names) and tests how often the word “labs” appears in all of them. If the word “amazon” only appears in a single document, that means that “amazon” is a significant word, but if the word “labs” appears in many other documents (e.g. many companies use the word “labs” as part of their name) then that means that the word “labs” is insignificant. IDF is just that — how many documents does the word appear in.","markups":[{"type":2,"start":0,"end":27},{"type":2,"start":108,"end":114}]},{"name":"6aca","type":1,"text":"TF-IDF is TF of the term, divided by the term’s IDF. It provides a good measurement of how important or how significant words are in the context of specific documents.","markups":[]},{"name":"8bb2","type":1,"text":"It’s easy to compute the TF-IDF matrix for a set of documents. There are ready-made libraries that do that, and we used scikit-learn’s implementation for that.","markups":[{"type":3,"start":120,"end":149,"href":"http://scikit-learn.org/stable/modules/feature_extraction.html#tfidf-term-weighting","title":"","rel":"","anchorType":0}]},{"name":"7f71","type":1,"text":"The TF-IDF matrix is a two dimensional matrix in which the rows represent documents (in our case — company names) and the columns represent unique tokens (or words). If we wanted to build the TF-IDF matrix of our little corpus from list A it’d look something like this (after the removal of stop-words, punctuation and lowercasing everything):","markups":[]},{"name":"935c","type":8,"text":"           | google | medium | com | yahoo | amazon | labs \n-----------------------------------------------------------\nGOOGLE INC.|   1         0      0      0        0      0\nMEDIUM.COM |   0        .77    .63     0        0      0\nAmazon labs|   0         0      0      0        .7     .7\nGoogle, inc|   1         0      0      0        0      0\nYahoo      |   0         0      0      1        0      0\ncom        |   0         0      1      0        0      0","markups":[]},{"name":"ff9d","type":1,"text":"Here’s the code:","markups":[]},{"name":"715e","type":8,"text":"from sklearn.feature_extraction.text import TfidfVectorizer","markups":[]},{"name":"a2cf","type":8,"text":"matrix = vectorizer.fit_transform(['GOOGLE','MEDIUM.COM', 'Amazon labs', 'Google', 'Yahoo', 'com'])","markups":[]},{"name":"cb73","type":1,"text":"The matrix that was created is NxM where N = number of companies and M = number of unique tokens.","markups":[]},{"name":"5288","type":1,"text":"You’d notice that we added another (made up) company named “com”. We did that in order to demonstrate an important property of TF-IDF. We use TF-IDF in order to distinguish between significant and insignificant tokens in the documents. A significant token in a document is a token that not only appears in the document often, but that is also relatively rare in the entire corpus. If a term appears many times in the corpus then it becomes less significant for this specific document. We added the made up company “com” so that ”Medium” within “Medium.com” becomes more significant. (You’d notice that “Medium” weight is .77 while “com” weight is .63, and that’s due to the appearance of “com” in another document hence it’s IDF is lower).","markups":[]},{"name":"e8e7","type":1,"text":"Of course in real world situation you’d have dozens or hundreds of company names with the token “com” or “labs” so you’d see a substantial difference between “Medium” and “com” within the name Medium.com.","markups":[]},{"name":"1361","type":13,"text":"Cosine Similarity","markups":[]},{"name":"0ae5","type":1,"text":"The next step after calculating the TF-IDF matrix for both sides (both lists A and B of companies) is to multiply the matrices.","markups":[{"type":1,"start":105,"end":126}]},{"name":"a045","type":1,"text":"Multiplying matrices provides an interesting measure called the Cosine Similarity. The cosine similarity is a simple similarity measurement that ranges between 0 and 1. A value of 1 indicates identical elements and a velue of 0 indicates completely different elements (just like the cosine trig function does). Multiplying the matrices provides the cosine similarity between every element in list A to every element in list B. As a matter of fact, we multiply A by B.T (B.transpose) so that the dimensions fit. The interesting thing about cosine similarity between TF-IDF matrices is that the result is a matrix of similarities between every element in A to every element in B, while taking into account the significance of tokens in the names. Usually a result of \x3e .8 means a valid match.","markups":[{"type":3,"start":64,"end":81,"href":"https://en.wikipedia.org/wiki/Cosine_similarity","title":"","rel":"","anchorType":0},{"type":2,"start":64,"end":81}]},{"name":"b6a9","type":1,"text":"Luckily the python package sklearn provides a simple cosine_similarity function that accepts two matrices and results in the cosine similarity of these two. Here’s some demo code:","markups":[{"type":2,"start":27,"end":34},{"type":2,"start":53,"end":70}]},{"name":"13d3","type":8,"text":"from sklearn.feature_extraction.text import TfidfVectorizer\nfrom sklearn.metrics.pairwise import cosine_similarity","markups":[]},{"name":"19b3","type":8,"text":"a = vectorizer.fit_transform(['aa','bb', 'aa bb', 'aa aa bb'])\nb = vectorizer.fit_transform(['aa', 'bb'])\ncosimilarities = cosine_similarity(a, b)","markups":[]},{"name":"610e","type":1,"text":"The result is a matrix of similarities between every element in A to every element in b.","markups":[]},{"name":"196c","type":8,"text":"           aa   |  bb\n----------------------\naa       | 1    |  0 \nbb       | 0    |  1\naa bb    | .7   |  .7\naa aa bb | .89  |  .44","markups":[]},{"name":"10be","type":1,"text":"As expected, the word “aa” from a is very similar to the word “aa” from b (note the 1). You can also see that “aa bb” is equally similar to both “aa” and “bb” and that also makes sense. And finally you’d notice that “aa aa bb” bares higher similarity to “aa” than it does to “bb”. This all makes sense.","markups":[]},{"name":"45b5","type":1,"text":"Let us sum up the science here. First we take two lists of documents and for each set we compute it’s TF-IDF matrix*. Then we multiply the two matrices to come up with their cosine similarity, which is a matrix that describes the similarity between every document in A to every document in B.","markups":[]},{"name":"3410","type":3,"text":"Second Attempt — numpy matrix multiplication","markups":[]},{"name":"4ac5","type":1,"text":"After having seen the science, we want to try this in practice. The next attempt is to load all real companies from list A and load all real companies from list B and multiply the heck out of them using the function cosine_similatiry.","markups":[{"type":2,"start":216,"end":233}]},{"name":"13d1","type":1,"text":"Easier said than done.","markups":[]},{"name":"4323","type":1,"text":"In small scale this simply works and it works very nicely. For example with a few thousand companies on each side that would work. However with our dataset, in which we have a couple of hundred of thousands names in each list, up to a few millions, this becomes challenging.","markups":[]},{"name":"1312","type":1,"text":"Simply calculating the TF-IDF is feasible, even with such large datasets, on a single host (my laptop runs that easily, in a few seconds). However, multiplying the matrices is where the real challenge is.","markups":[]},{"name":"bc8b","type":13,"text":"Local multiplication doesn’t scale","markups":[]},{"name":"0eb2","type":1,"text":"Let’s assume we have 1M (10⁶) names in each list. Each matrix then would be about the order of 10⁶ x 10⁶ (since the number of unique tokens is similar in order to the number of companies due to uniqueness of names). Creating a 10⁶ x 10⁶ matrix in memory means 10¹² floats. A python float takes 16 bytes so we end up with 16*10¹² bytes, which translates to ~4PT (four petabytes) of RAM. Can we keep a 4PT matrix in memory? Well, of course not, at least not on my shabby laptop. But — there’s a trick. We don’t have to keep it all in memory. Keep in mind that although the matrix is 1M on 1M, in practice it is mostly filled with Zeros. So, why should we bother maintaining all these zeros in memory? We can instead use a sparse representation of the matrix, in which instead of keeping the two dimensional matrix in memory using arrays of arrays, we can instead only keep track of the coordinates of the non-zero elements and assume that all the rest are just zeros. That’s great for preserving low memory footprint as well as executing fast matrix multiplication operations. And as a matter of fact, this is exactly what sklearn already does. Keeping the matrices as Sparse Matrices means that we only have to allocate around 1M floats (values), plus 2M integers (indices of non-zero elements), but all in all it’s about 24Mbytes, which is quite easy.","markups":[{"type":1,"start":609,"end":633},{"type":2,"start":500,"end":538},{"type":2,"start":720,"end":726}]},{"name":"81e8","type":1,"text":"But — multiplying the two matrices, even that they are sparse, would mean at the very least 10¹² operations (if we’re smart with the zeros). Now that is a bit harder. And although numpy (which lies underneath sklearn) is very good at such fast math, this thing is a bit challenging even for numpy.","markups":[]},{"name":"3b7a","type":1,"text":"We tried that — simply multiplying these two matrices. It works well for small enough matrix size, but at some numbers (which are much smaller than what we want) it started to fail and run out of memory. Now, we could’ve worked this out by splitting one of the matrices to smaller chunks and running a number or multiplications one after the other and then summing all things up. But, this kind of reminded us that we already know that kind of system that does that, it’s called Spark.","markups":[]},{"name":"778d","type":3,"text":"Third Attempt — Spark matrix multiplication","markups":[]},{"name":"2a0c","type":1,"text":"Spark is great for highly parallelized memory intensive computations and lo and behold, it has a BlockMatrix data type which implements a multiply operation. Looks like exactly what we were looking for! OK, so we create the TF-IDF matrices and convert them to Spark’s BlockMatrix and run a.multiply(b.transpose()) which is more or less what cosine_similatiry does.","markups":[{"type":3,"start":0,"end":5,"href":"https://spark.apache.org/","title":"","rel":"","anchorType":0},{"type":3,"start":97,"end":108,"href":"https://spark.apache.org/docs/1.6.2/api/python/pyspark.mllib.html#pyspark.mllib.linalg.distributed.BlockMatrix","title":"","rel":"","anchorType":0},{"type":3,"start":138,"end":146,"href":"https://spark.apache.org/docs/1.6.2/api/python/pyspark.mllib.html#pyspark.mllib.linalg.distributed.BlockMatrix.multiply","title":"","rel":"","anchorType":0},{"type":2,"start":288,"end":313}]},{"name":"7ce4","type":8,"text":"# Pseudocode...","markups":[]},{"name":"2653","type":8,"text":"a_mat = tfidf_vect.fit_transform([..., ..., ...])\nb_mat = tfidf_vect.fit_transform([..., ..., ...])","markups":[]},{"name":"34a1","type":8,"text":"a_block_mat = create_block_matrix(a)\nb_block_mat_tr = create_block_matrix(b.transpose())","markups":[]},{"name":"ab3e","type":8,"text":"cosimilarities = a_block_mat.multiply(b_block_mat_tr)","markups":[]},{"name":"9cab","type":1,"text":"This seems easy enough, and it really is. But there’s a “but” of course… this thing, although simple and works correctly from the math point of view — well, it doesn’t scale… We’re able to multiply large matrices, but not as large as we would like to. We tried playing with the block sizes etc alas, for large enough inputs it fails with either out-of-memory errors or just long runs that never end (hours and hours).","markups":[]},{"name":"1d34","type":1,"text":"What’s the problem? Can’t Spark scale?","markups":[]},{"name":"3a9a","type":1,"text":"Of course spark can scale. But you have to use it wisely, stupid... The problem with BlockMatrix is that in order to implement the multiply operation Spark converts the sparse blocks of the matrix into dense (sub)matrices. And although most of our matrix is zeros, spark would still convert all these zeros into dense representation, which would either consume too much memory, or if we keep the size of the blocks small, would result in too many operations, repartitions etc and run forever.","markups":[{"type":2,"start":202,"end":207}]},{"name":"cef5","type":1,"text":"Spark does support sparse matrices, but these matrices do not implement the multiply (aka dot) operation, and the only distributed matrix that does implement the multiply operation as of the time of writing is the BlockMatrix, which as noted, converts the sparse representation into dense representation before multiplying them. We should note that there had been discussions in the spark community about ways to implement distributed sparse matrix multiplication, however as noted — at the time of this writing, this was not implemented yet.","markups":[{"type":2,"start":76,"end":84},{"type":2,"start":90,"end":93}]},{"name":"c196","type":1,"text":"BlockMatrix.multiply() failed. What’s next?","markups":[{"type":2,"start":0,"end":22}]},{"name":"6dd0","type":3,"text":"Fourth Attempt — and the winner is…","markups":[]},{"name":"0b4a","type":1,"text":"Our fourth and last attempt was successful. The idea is to mix and match Spark with numpy. Our tests show that numpy is able to multiply a smaller matrix with a larger matrix, so if we take just a small chunk of matrix A and multiply that by matrix B, that would work and numpy would not explode. And if you recall your algebra lessons, multiplying matrices can be done vector-by-vector so algebraic-wise that would still be correct. The idea is to split just one of the matrices into smaller pieces, and then have each Spark worker run the multiply on its chunk, and then return just the conclusion, e.g. the conclusion might be that the name at A[13] matches the name at B[21] etc.","markups":[{"type":2,"start":449,"end":479}]},{"name":"c462","type":13,"text":"Broadcast and Parallelize to the rescue","markups":[]},{"name":"d6c8","type":1,"text":"Spark has two useful capabilities: broadcast and parallelize. Broadcast simply broadcasts the exact same data to all the workers. We use broadcast to send matrix B to all workers so that all workers have the complete B matrix. Parallelize chunks the data into partitions and sends each partition to a different worker. We use parallelize to send chunks of A to the workers so that each worker has all of B but just a small chunk of A.","markups":[{"type":1,"start":62,"end":71},{"type":1,"start":227,"end":238},{"type":2,"start":35,"end":44},{"type":2,"start":49,"end":60},{"type":2,"start":346,"end":357}]},{"name":"0993","type":1,"text":"Here’s the general outline:","markups":[]},{"name":"5526","type":10,"text":"Calculate TF-IDF matrices on the driver.","markups":[]},{"name":"cead","type":10,"text":"Parallelize matrix A; Broadcast matrix B","markups":[]},{"name":"dfda","type":10,"text":"Each worker now flatMaps its chunk of work by multiplying its chunk of matrix A with the entire matrix B. So if a worker operates on A[0:99] then it would multiply these hundred rows and return the result of, say A[13] matches a name found in B[21]. Multiplication is done using numpy.","markups":[{"type":2,"start":17,"end":23}]},{"name":"3d3a","type":10,"text":"The driver would collect back all the results from the different workers and match the indices (A[13] and B[21]) to the actual names in the original dataset — and we’re done!","markups":[]},{"name":"1bc5","type":1,"text":"This method works very well and as a matter of fact when it ran for the first time it was such a nice surprise that we thought it just didn’t work (but it did…). Compared to the previous methods, which either ran for hours (and didn’t finish) or ran out or memory, this method was able to complete its computation in order of just a few minutes. Of course it depends on the size of the data and the size of Spark’s cluster, but all in all it performed really well.","markups":[]},{"name":"c501","type":1,"text":"Right now the only bottleneck is the driver calculating TF-IDF matrices and on that front we still have tons of elbow space because this calculation is still quite easy for sklearn. (side-note: Spark also implements distributed TF-IDF calculation but we didn’t have to use it).","markups":[]},{"name":"3ff6","type":1,"text":"Here’s pseudocode to illustrate our solution:","markups":[]},{"name":"3358","type":8,"text":"from sklearn.feature_extraction.text import TfidfVectorizer\nfrom sklearn.feature_extraction.text import CountVectorizer\nfrom sklearn.metrics.pairwise import cosine_similarity","markups":[]},{"name":"0982","type":8,"text":"# these would realistically get read from files or dataframes. \na = ['google inc', 'medium.com', ...] \nb = ['google', 'microsoft', ...]\nstopwords = ['ltd', ...]\nvect = CountVectorizer(stop_words=stopwords)\n# this can be done with less memory overhead by using a generator\nvocabulary =  vect.fit(a + b).vocabulary_\ntfidf_vect = TfidfVectorizer(stop_words=stopwords,\n                             vocabulary=vocabulary)\na_mat = tfidf_vect.fit_transform(a)\nb_mat = tfidf_vect.fit_transform(b)","markups":[]},{"name":"bb28","type":8,"text":"a_mat_para = parallelize_matrix(a_mat, rows_per_chunk=100)\nb_mat_dist = broadcast_matrix(a_mat)\na_mat_para.flatMap(\n        lambda submatrix:\n        find_matches_in_submatrix(csr_matrix(submatrix[1],\n                                             shape=submatrix[2]),\n                                   b_mat_dist,\n                                   submatrix[0]))","markups":[]},{"name":"6b03","type":8,"text":"def find_matches_in_submatrix(sources, targets, inputs_start_index,\n                              threshold=.8):\n    cosimilarities = cosine_similarity(sources, targets)\n    for i, cosimilarity in enumerate(cosimilarities):\n        cosimilarity = cosimilarity.flatten()\n        # Find the best match by using argsort()[-1]\n        target_index = cosimilarity.argsort()[-1]\n        source_index = inputs_start_index + i\n        similarity = cosimilarity[target_index]\n        if cosimilarity[target_index] \x3e= threshold:\n            yield (source_index, target_index, similarity)","markups":[]},{"name":"f442","type":8,"text":"def broadcast_matrix(mat):\n    bcast = sc.broadcast((mat.data, mat.indices, mat.indptr))\n    (data, indices, indptr) = bcast.value\n    bcast_mat = csr_matrix((data, indices, indptr), shape=mat.shape)\n    return bcast_mat","markups":[{"type":1,"start":42,"end":51}]},{"name":"4d60","type":8,"text":"def parallelize_matrix(scipy_mat, rows_per_chunk=100):\n    [rows, cols] = scipy_mat.shape\n    i = 0\n    submatrices = []\n    while i \x3c rows:\n        current_chunk_size = min(rows_per_chunk, rows - i)\n        submat = scipy_mat[i:i + current_chunk_size]\n        submatrices.append((i, (submat.data, submat.indices, \n                                submat.indptr),\n                            (current_chunk_size, cols)))\n        i += current_chunk_size\n    return sc.parallelize(submatrices)","markups":[{"type":1,"start":466,"end":477}]},{"name":"4949","type":1,"text":"You’d notice that after the broadcast and parallelize, we re-assemble the matrix into scipy csr_matrix, which is what it originated from. So what we basically do is — we serialize the matrices over the wire and then reassemble them on the other side, on the workers. The serialization is efficient since we only need to send the non-zero elements of the sparse matrix. So for a matrix of 1M elements we only send about 1M floats, along with 2M ints, which is definitely in the comfort zone of Spark.","markups":[{"type":2,"start":92,"end":102}]},{"name":"a27b","type":3,"text":"Conclusion","markups":[]},{"name":"0a0b","type":1,"text":"We describe a method for finding similarity between two lists of strings A and B which describe company names. We used TF-IDF and cosine-similarity as a similarity factor.","markups":[]},{"name":"3d43","type":1,"text":"Next we show various attempts for scalable implementation of matrix multiplication using spark, and the winning method which combines numpy matrix multiplication along with spark’s broadcast and parallelize capabilities.","markups":[]},{"name":"5241","type":1,"text":"* One fine point to mention: the vocabulary of both matrices must be the same. In other words the number of rows in both matrices must be equal and they must have exactly the same order e.g. each row represents a term and the order of the rows must be exactly the same between matrix A and matrix B. This is easily done by first calculating the vocabulary and only then calculating the TF-IDF as in the following example:","markups":[]},{"name":"7ff4","type":8,"text":"from sklearn.feature_extraction.text import TfidfVectorizer\nfrom sklearn.feature_extraction.text import CountVectorizer\nfrom sklearn.metrics.pairwise import cosine_similarity","markups":[]},{"name":"b682","type":8,"text":"a = ['google inc', 'medium.com']\nb = ['google', 'microsoft']\ncompany_name_stopwords = frozenset(['ltd', 'llc', 'inc'])\nvect = CountVectorizer(stop_words=company_name_stopwords)\nvocabulary =  vect.fit(a + b).vocabulary_\ntfidf_vect = TfidfVectorizer(stop_words=company_name_stopwords,\n                             vocabulary=vocabulary)\na_mat = tfidf_vect.fit_transform(a)\nb_mat = tfidf_vect.fit_transform(b)\ncosimilarities = cosine_similarity(a_mat, b_mat)","markups":[{"type":1,"start":177,"end":219},{"type":1,"start":312,"end":333}]}],"sections":[{"name":"090f","startIndex":0},{"name":"86c2","startIndex":93}]},"postDisplay":{"coverless":true}},"virtuals":{"allowNotes":true,"previewImage":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"wordCount":3686,"imageCount":0,"readingTime":13.909433962264151,"subtitle":"Spark and pyspark have wonderful support for reliable distribution and parallelization of programs as well as support for many basic…","usersBySocialRecommends":[],"noIndex":false,"recommends":49,"socialRecommends":[],"isBookmarked":false,"tags":[{"slug":"data-science","name":"Data Science","postCount":29119,"virtuals":{"isFollowing":false},"metadata":{"followerCount":14289,"postCount":29119,"coverImage":{"id":"1*KteGDjA9gflRcRcEThpy4w.gif","originalWidth":576,"originalHeight":576,"isFeatured":true}},"type":"Tag"},{"slug":"machine-learning","name":"Machine Learning","postCount":44802,"virtuals":{"isFollowing":false},"metadata":{"followerCount":23701,"postCount":44802,"coverImage":{"id":"1*gccuMDV8fXjcvz1RSk4kgQ.png","originalWidth":2000,"originalHeight":3000}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":5,"links":{"entries":[],"version":"0.3","generatedAt":1472501914364},"isLockedPreviewOnly":false,"takeoverId":"","metaDescription":"","totalClapCount":97,"sectionCount":2,"readingList":0,"topics":[]},"coverless":true,"slug":"large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":true,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e","previewContent":{"bodyModel":{"paragraphs":[{"name":"2954","type":3,"text":"Large scale matrix multiplication with pyspark (or — how to match two large datasets of company names)","markups":[],"alignment":1},{"name":"a2e3","type":1,"text":"Spark and pyspark have wonderful support for reliable distribution and parallelization of programs as well as support for many basic algebraic operations…","markups":[],"alignment":1}],"sections":[{"startIndex":0}]},"isFullContent":false,"subtitle":"Spark and pyspark have wonderful support for reliable distribution and parallelization of programs as well as support for many basic…"},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e","approvedHomeCollectionId":"","newsletterId":"","webCanonicalUrl":"https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e","mediumUrl":"https://medium.com/@rantav/large-scale-matrix-multiplication-with-pyspark-or-how-to-match-two-large-datasets-of-company-1be4b1b2871e","migrationId":"","notifyFollowers":true,"notifyTwitter":false,"isSponsored":false,"isRequestToPubDisabled":false,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"audioVersionDurationSec":0,"sequenceId":"","isNsfw":false,"isEligibleForRevenue":false,"isBlockedFromHightower":false,"deletedAt":0,"lockedPostSource":0,"hightowerMinimumGuaranteeStartsAt":0,"hightowerMinimumGuaranteeEndsAt":0,"featureLockRequestAcceptedAt":0,"featureLockRequestMinimumGuaranteeAmount":0,"isElevate":false,"mongerRequestType":1,"layerCake":0,"socialTitle":"","socialDek":"","editorialPreviewTitle":"","editorialPreviewDek":"","type":"Post"},"mentionedUsers":[],"collaborators":[],"collectionUserRelations":[],"mode":null,"references":{"User":{"586fab9c92fd":{"userId":"586fab9c92fd","name":"Ran Tavory","username":"rantav","createdAt":1369486700069,"lastPostCreatedAt":1510166886120,"imageId":"0*FtaU3aCLl7AOm9qe.jpg","backgroundImageId":"","bio":"Founder yodas.com","twitterScreenName":"rantav","socialStats":{"userId":"586fab9c92fd","usersFollowedCount":217,"usersFollowedByCount":501,"type":"SocialStats"},"social":{"userId":"lo_7ee23abbbab9","targetUserId":"586fab9c92fd","type":"Social"},"facebookAccountId":"10152390218577174","allowNotes":1,"isNsfw":false,"isWriterProgramInvited":false,"isPartnerProgramEnrolled":false,"isWriterProgramEnrolled":false,"isWriterProgramOptedOut":false,"type":"User"}},"Social":{"586fab9c92fd":{"userId":"lo_7ee23abbbab9","targetUserId":"586fab9c92fd","type":"Social"}},"SocialStats":{"586fab9c92fd":{"userId":"586fab9c92fd","usersFollowedCount":217,"usersFollowedByCount":501,"type":"SocialStats"}}}})
// ]]></script><script id="parsely-cfg" src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/p.js.download"></script><div class="surface-scrollOverlay"></div><script charset="UTF-8" src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/main-common-async.bundle.nJD9-yjP0__r2XhkwIzYwQ.js.download"></script><script charset="UTF-8" src="./Large scale matrix multiplication with pyspark (or — how to match two large datasets of company…_files/main-notes.bundle.YL0ZDiM8Uv0f_wuvzZFRDQ.js.download"></script></body></html>